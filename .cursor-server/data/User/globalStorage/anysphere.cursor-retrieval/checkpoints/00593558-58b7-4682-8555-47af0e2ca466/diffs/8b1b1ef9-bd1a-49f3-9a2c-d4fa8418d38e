{"fsPath":"\\home\\oxetech_mcz\\docs\\BI_LAB_DETALHADO.md","fileUuid":"8b1b1ef9-bd1a-49f3-9a2c-d4fa8418d38e","fileSizeBytes":8965,"numLines":368,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":369,"addedLines":["# An√°lise Detalhada do OxeTech Lab - Business Intelligence","","## ‚úÖ Implementa√ß√£o Completa","","### üìä Funcionalidades Criadas","","#### 1. **An√°lise Detalhada do Lab** (`lib/bi/lab-analysis.ts`)","   - ‚úÖ M√©tricas por laborat√≥rio","   - ‚úÖ Taxa de evas√£o por laborat√≥rio","   - ‚úÖ Taxa de certifica√ß√£o por laborat√≥rio","   - ‚úÖ Taxa de ocupa√ß√£o por laborat√≥rio","   - ‚úÖ An√°lise por curso normalizado","   - ‚úÖ Alunos certificados de fato (status TWO)","   - ‚úÖ Desempenho e rankings","   - ‚úÖ Tend√™ncias e sazonalidade","   - ‚úÖ Alertas autom√°ticos","   - ‚úÖ Top 10 laborat√≥rios","   - ‚úÖ Laborat√≥rios com problemas","","#### 2. **API Route** (`/api/bi/lab-detalhado`)","   - ‚úÖ GET endpoint funcional","   - ‚úÖ Tratamento de erros","   - ‚úÖ Cache implementado (10 minutos)","   - ‚úÖ Valida√ß√µes de dados","","#### 3. **React Query Hook** (`lib/queries/bi-lab.ts`)","   - ‚úÖ `useLabDetalhado()` hook","   - ‚úÖ Configura√ß√£o de cache otimizada","   - ‚úÖ Credentials inclu√≠dos","   - ‚úÖ Refetch autom√°tico","","#### 4. **P√°gina de Visualiza√ß√£o** (`/bi/lab`)","   - ‚úÖ Interface completa e moderna","   - ‚úÖ KPIs principais","   - ‚úÖ Alertas cr√≠ticos","   - ‚úÖ Tabelas de laborat√≥rios","   - ‚úÖ Tabelas de cursos","   - ‚úÖ Lista de alunos certificados","   - ‚úÖ Gr√°ficos interativos","   - ‚úÖ Top 10 performance","","### üìà M√©tricas Implementadas","","#### Resumo Geral","- Total de laborat√≥rios","- Total de turmas","- Total de inscri√ß√µes","- Total de certificados (status TWO)","- Taxa de certifica√ß√£o geral","- Taxa de evas√£o geral","- Taxa de ocupa√ß√£o geral","","#### Por Laborat√≥rio","- Nome e munic√≠pio","- Total de turmas","- Total de inscri√ß√µes","- Total de certificados","- Taxa de certifica√ß√£o (%)","- Taxa de evas√£o (%)","- Taxa de ocupa√ß√£o (%)","- Vagas total / ocupadas / livres","- N√∫mero de cursos oferecidos","- Ranking por performance","","#### Por Curso","- Curso normalizado","- Categoria","- Total de turmas","- Total de inscri√ß√µes","- Total de certificados","- Taxa de certifica√ß√£o (%)","- Taxa de evas√£o (%)","- Laborat√≥rios que oferecem","- Munic√≠pios atendidos","","#### Alunos Certificados de Fato","- Dados completos do aluno (nome, email, telefone, munic√≠pio)","- Curso e laborat√≥rio","- Data de inscri√ß√£o","- Data de conclus√£o","- Tempo de conclus√£o (dias)","- Status: TWO (certificado)","","#### Evas√£o","- Taxa de evas√£o por laborat√≥rio","- Taxa de evas√£o por curso","- Principais motivos (simulado - ajustar conforme dados reais)","- Cursos afetados","","#### Desempenho","- Top 10 laborat√≥rios (por score)","- Score calculado por:","  - Total de certificados (50%)","  - Taxa de ocupa√ß√£o (30%)","  - Diversidade de cursos (20%)","- Laborat√≥rios com problemas:","  - Evas√£o alta (> 50%)","  - Evas√£o m√©dia (30-50%)","  - Baixa ocupa√ß√£o (< 30%)","  - Baixa certifica√ß√£o (< 20%)","","#### Tend√™ncias","- Crescimento de inscri√ß√µes (3 e 6 meses)","- Crescimento de certificados (3 e 6 meses)","- Sazonalidade (m√™s mais/menos ativo)","- Tend√™ncia: crescimento, est√°vel ou decl√≠nio","","#### Alertas Autom√°ticos","- Evas√£o cr√≠tica (> 50%)","- Baixa ocupa√ß√£o (< 30%)","- Baixa certifica√ß√£o (< 20%)","- Severidade: alta, m√©dia, baixa","","### üéØ Dados Valiosos","","#### **Alunos Certificados de Fato**","- ‚úÖ Identificados por status 'TWO' em `oxetechlab_inscricoes`","- ‚úÖ Lista completa com:","  - Nome, email, telefone","  - Munic√≠pio","  - Curso normalizado","  - Laborat√≥rio","  - Data de conclus√£o","  - Tempo de conclus√£o em dias","- ‚úÖ Ordenados por data de conclus√£o (mais recentes primeiro)","- ‚úÖ Exibi√ß√£o limitada a 50 por vez (com contador total)","","### üîß Como Usar","","#### 1. **Acessar a P√°gina**","   ```","   /bi/lab","   ```","   Ou clique em \"BI Lab Detalhado\" na sidebar","","#### 2. **Gerar Dados Automaticamente**","   - Os dados s√£o gerados automaticamente ao acessar a p√°gina","   - Cache de 10 minutos para performance","   - Refetch autom√°tico a cada 15 minutos","","#### 3. **Visualizar M√©tricas**","   - **KPIs Principais**: Cards no topo","   - **Alertas**: Cards destacados em vermelho/amarelo","   - **Tabelas**: Laborat√≥rios, cursos, alunos certificados","   - **Gr√°ficos**: Comparativos visuais","   - **Rankings**: Top 10 laborat√≥rios","","### üìù Estrutura dos Dados","","```typescript","interface AnaliseDetalhadaLab {","  resumo: {","    totalLaboratorios: number","    totalTurmas: number","    totalInscricoes: number","    totalCertificados: number","    taxaCertificacaoGeral: number","    taxaEvasaoGeral: number","    taxaOcupacaoGeral: number","  }","  porLaboratorio: Array<{","    laboratorioId: number","    nome: string","    municipio: string","    totalTurmas: number","    totalInscricoes: number","    totalCertificados: number","    taxaCertificacao: number","    taxaEvasao: number","    taxaOcupacao: number","    vagasTotal: number","    vagasOcupadas: number","    vagasLivres: number","    cursosOferecidos: number","    ranking: number","  }>","  porCurso: Array<{","    curso: string","    cursoNormalizado: string","    categoria: string","    totalTurmas: number","    totalInscricoes: number","    totalCertificados: number","    taxaCertificacao: number","    taxaEvasao: number","    laboratorios: string[]","    municipios: string[]","  }>","  alunosCertificados: Array<{","    alunoId: number","    nome: string","    email: string","    telefone: string","    municipio: string","    curso: string","    cursoNormalizado: string","    laboratorio: string","    dataInscricao: Date","    dataConclusao: Date","    tempoConclusao: number // dias","  }>","  evasao: {","    porLaboratorio: Array<{","      laboratorio: string","      municipio: string","      totalInscricoes: number","      totalEvasao: number","      taxaEvasao: number","      cursosAfetados: string[]","    }>","    porCurso: Array<{","      curso: string","      cursoNormalizado: string","      totalInscricoes: number","      totalEvasao: number","      taxaEvasao: number","    }>","    principaisMotivos: Array<{","      motivo: string","      quantidade: number","      percentual: number","    }>","  }","  desempenho: {","    laboratoriosTop10: Array<{","      laboratorio: string","      municipio: string","      score: number","      criterios: {","        taxaCertificacao: number","        taxaOcupacao: number","        totalCertificados: number","        diversidadeCursos: number","      }","    }>","    laboratoriosComProblemas: Array<{","      laboratorio: string","      municipio: string","      problema: string","      severidade: 'alta' | 'media' | 'baixa'","      detalhes: string","    }>","  }","  tendencias: {","    crescimentoInscricoes: {","      ultimos3Meses: number","      ultimos6Meses: number","      tendencia: 'crescimento' | 'estavel' | 'declinio'","    }","    crescimentoCertificados: {","      ultimos3Meses: number","      ultimos6Meses: number","      tendencia: 'crescimento' | 'estavel' | 'declinio'","    }","    sazonalidade: {","      mesMaisAtivo: string","      mesMenosAtivo: string","      variacao: number","    }","  }","  alertas: Array<{","    tipo: 'evasao' | 'ocupacao' | 'certificacao' | 'outro'","    severidade: 'alta' | 'media' | 'baixa'","    titulo: string","    descricao: string","    laboratorio?: string","    curso?: string","  }>","}","```","","### üé® Interface","","#### **Cores e Estilo**","- ‚úÖ Cores do m√≥dulo Lab (#FF6A00)","- ‚úÖ Cards com border-radius 22px","- ‚úÖ Sombras premium (soft)","- ‚úÖ Anima√ß√µes suaves com Framer Motion","- ‚úÖ Badges coloridos por severidade","- ‚úÖ Gr√°ficos interativos com Recharts","","#### **Componentes Utilizados**","- ‚úÖ KPICard (KPIs principais)","- ‚úÖ Card (se√ß√µes de conte√∫do)","- ‚úÖ Badge (severidade e rankings)","- ‚úÖ BarChart (gr√°ficos comparativos)","- ‚úÖ Tabelas responsivas","- ‚úÖ Loading states","- ‚úÖ Error handling","","### üîç Detalhes T√©cnicos","","#### **Queries Otimizadas**","- ‚úÖ Promise.all para queries paralelas","- ‚úÖ Sele√ß√µes espec√≠ficas (n√£o SELECT *)","- ‚úÖ Agrega√ß√µes no c√≥digo quando necess√°rio","- ‚úÖ Normaliza√ß√£o de cursos","","#### **Cache**","- ‚úÖ LRU Cache implementado","- ‚úÖ TTL de 10 minutos","- ‚úÖ Invalida√ß√£o autom√°tica","- ‚úÖ Chaves de cache √∫nicas","","#### **Valida√ß√µes**","- ‚úÖ Tratamento de null/undefined","- ‚úÖ Prote√ß√£o contra divis√£o por zero","- ‚úÖ Valida√ß√£o de arrays vazios","- ‚úÖ Fallbacks para dados faltantes","","### üìä Exemplos de Uso","","#### **Verificar Taxa de Evas√£o por Laborat√≥rio**","```typescript","const { data } = useLabDetalhado()","const evasaoPorLab = data?.evasao.porLaboratorio","// Ordenado por taxa de evas√£o (maior primeiro)","```","","#### **Listar Alunos Certificados**","```typescript","const { data } = useLabDetalhado()","const certificados = data?.alunosCertificados","// Lista completa com contatos e detalhes","```","","#### **Identificar Laborat√≥rios com Problemas**","```typescript","const { data } = useLabDetalhado()","const problemas = data?.desempenho.laboratoriosComProblemas","// Filtrar por severidade: 'alta', 'media', 'baixa'","```","","### üöÄ Pr√≥ximos Passos Recomendados","","1. **Exporta√ß√£o**","   - Exportar relat√≥rios para PDF/XLSX","   - Exportar lista de certificados","","2. **Filtros**","   - Filtrar por munic√≠pio","   - Filtrar por per√≠odo","   - Filtrar por curso","","3. **Compara√ß√µes**","   - Comparar laborat√≥rios","   - Comparar per√≠odos","   - Comparar cursos","","4. **Alertas em Tempo Real**","   - Notifica√ß√µes push","   - Dashboard de alertas","   - Hist√≥rico de alertas","","5. **A√ß√µes**","   - Resolver alertas","   - Registrar a√ß√µes corretivas","   - Acompanhamento de melhorias","","---","","**Status**: ‚úÖ IMPLEMENTADO E FUNCIONANDO  ","**Build**: ‚úÖ PASSANDO  ","**P√°gina**: ‚úÖ `/bi/lab`  ","**API**: ‚úÖ `/api/bi/lab-detalhado`  ","**Hook**: ‚úÖ `useLabDetalhado()`","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000001,1000003,1000001,1000004,1000005,1000006,1000007,1000008,1000009,1000010,1000011,1000012,1000013,1000014,1000015,1000001,1000016,1000017,1000018,1000019,1000020,1000001,1000021,1000022,1000023,1000024,1000025,1000001,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000001,1000035,1000001,1000036,1000037,1000038,1000039,1000040,1000041,1000042,1000043,1000001,1000044,1000045,1000038,1000039,1000046,1000047,1000048,1000049,1000050,1000051,1000052,1000001,1000053,1000054,1000055,1000038,1000039,1000046,1000047,1000048,1000056,1000057,1000001,1000058,1000059,1000060,1000061,1000062,1000063,1000064,1000001,1000065,1000066,1000067,1000068,1000069,1000001,1000070,1000071,1000072,1000073,1000074,1000075,1000076,1000077,1000078,1000079,1000080,1000001,1000081,1000082,1000083,1000084,1000085,1000001,1000086,1000087,1000088,1000089,1000090,1000001,1000091,1000001,1000092,1000093,1000094,1000095,1000096,1000097,1000098,1000099,1000100,1000101,1000102,1000001,1000103,1000001,1000104,1000105,1000106,1000105,1000107,1000001,1000108,1000109,1000110,1000111,1000001,1000112,1000113,1000114,1000115,1000116,1000117,1000001,1000118,1000001,1000119,1000120,1000121,1000122,1000123,1000124,1000125,1000126,1000127,1000128,1000129,1000130,1000131,1000132,1000133,1000123,1000124,1000125,1000134,1000135,1000136,1000137,1000138,1000139,1000140,1000141,1000142,1000143,1000144,1000145,1000146,1000123,1000124,1000125,1000134,1000135,1000147,1000148,1000142,1000149,1000150,1000132,1000151,1000152,1000133,1000144,1000145,1000153,1000154,1000155,1000156,1000142,1000157,1000158,1000159,1000160,1000161,1000162,1000163,1000164,1000165,1000166,1000167,1000168,1000161,1000162,1000163,1000165,1000169,1000170,1000171,1000172,1000165,1000129,1000173,1000174,1000159,1000160,1000175,1000176,1000177,1000178,1000179,1000180,1000181,1000165,1000182,1000159,1000160,1000183,1000184,1000185,1000165,1000129,1000186,1000187,1000188,1000189,1000190,1000191,1000192,1000188,1000189,1000190,1000191,1000193,1000194,1000195,1000196,1000191,1000129,1000197,1000198,1000199,1000200,1000201,1000202,1000203,1000142,1000204,1000205,1000001,1000206,1000001,1000207,1000208,1000209,1000210,1000211,1000212,1000213,1000001,1000214,1000215,1000216,1000217,1000218,1000219,1000220,1000221,1000001,1000222,1000001,1000223,1000224,1000225,1000226,1000227,1000001,1000228,1000229,1000230,1000231,1000232,1000001,1000233,1000234,1000235,1000236,1000237,1000001,1000238,1000001,1000239,1000119,1000240,1000241,1000242,1000205,1000001,1000243,1000119,1000240,1000244,1000245,1000205,1000001,1000246,1000119,1000240,1000247,1000248,1000205,1000001,1000249,1000001,1000250,1000251,1000252,1000001,1000253,1000254,1000255,1000256,1000001,1000257,1000258,1000259,1000260,1000001,1000261,1000262,1000263,1000264,1000001,1000265,1000266,1000267,1000268,1000001,1000269,1000001,1000270,1000271,1000272,1000273,1000274,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}
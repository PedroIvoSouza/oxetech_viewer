{"fsPath":"\\home\\oxetech_mcz\\app\\(dashboard)\\bi\\lab\\page.tsx","fileUuid":"ec8f729b-ea60-4430-9b27-8fcc199dd88a","fileSizeBytes":19059,"numLines":459,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":460,"addedLines":["'use client'","","import { useLabDetalhado } from '@/lib/queries/bi-lab'","import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'","import { KPICard } from '@/components/dashboard/kpi-card'","import { BarChart } from '@/components/charts/bar-chart'","import { LineChart } from '@/components/charts/line-chart'","import { PieChart } from '@/components/charts/pie-chart'","import { Badge } from '@/components/ui/badge'","import { ","  TrendingUp, ","  Users, ","  Award, ","  MapPin, ","  AlertTriangle,","  Building2,","  BookOpen,","  Target,","  TrendingDown,","} from 'lucide-react'","import { motion } from 'framer-motion'","import { formatNumber, formatPercent, formatDate } from '@/lib/formatters'","","export default function BILabPage() {","  const { data, isLoading, error } = useLabDetalhado()","","  if (isLoading) {","    return (","      <div className=\"flex items-center justify-center h-96\">","        <div className=\"text-center\">","          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-lab-primary mx-auto mb-4\"></div>","          <p className=\"text-muted-foreground\">Carregando análise detalhada do Lab...</p>","        </div>","      </div>","    )","  }","","  if (error) {","    return (","      <div className=\"flex items-center justify-center h-96\">","        <Card className=\"border-destructive\">","          <CardContent className=\"pt-6\">","            <div className=\"text-center\">","              <AlertTriangle className=\"h-12 w-12 text-destructive mx-auto mb-4\" />","              <p className=\"text-destructive font-semibold\">Erro ao carregar dados</p>","              <p className=\"text-sm text-muted-foreground mt-2\">{error.message}</p>","            </div>","          </CardContent>","        </Card>","      </div>","    )","  }","","  if (!data) {","    return (","      <div className=\"flex items-center justify-center h-96\">","        <p className=\"text-muted-foreground\">Nenhum dado disponível</p>","      </div>","    )","  }","","  const {","    resumo,","    porLaboratorio,","    porCurso,","    alunosCertificados,","    evasao,","    desempenho,","    tendencias,","    alertas,","  } = data","","  // Preparar dados para gráficos","  const top10Laboratorios = porLaboratorio.slice(0, 10).map((lab) => ({","    laboratorio: lab.nome,","    certificacao: lab.taxaCertificacao,","    evasao: lab.taxaEvasao,","    ocupacao: lab.taxaOcupacao,","  }))","","  const top10Cursos = porCurso.slice(0, 10).map((curso) => ({","    curso: curso.cursoNormalizado,","    inscricoes: curso.totalInscricoes,","    certificados: curso.totalCertificados,","    evasao: curso.taxaEvasao,","  }))","","  const evasaoPorLab = evasao.porLaboratorio.slice(0, 10).map((e) => ({","    laboratorio: e.laboratorio,","    taxa: e.taxaEvasao,","    total: e.totalEvasao,","  }))","","  return (","    <div className=\"space-y-8\">","      {/* Header */}","      <div>","        <h1 className=\"text-4xl font-bold mb-2\" style={{ color: '#FF6A00' }}>","          Análise Detalhada - OxeTech Lab","        </h1>","        <p className=\"text-muted-foreground\">","          Métricas avançadas e insights estratégicos do programa Lab","        </p>","      </div>","","      {/* Alertas Críticos */}","      {alertas.length > 0 && (","        <Card className=\"border-destructive border-2\">","          <CardHeader>","            <CardTitle className=\"flex items-center gap-2 text-destructive\">","              <AlertTriangle className=\"h-5 w-5\" />","              Alertas Críticos ({alertas.length})","            </CardTitle>","          </CardHeader>","          <CardContent>","            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">","              {alertas.map((alerta, index) => (","                <motion.div","                  key={index}","                  initial={{ opacity: 0, x: -20 }}","                  animate={{ opacity: 1, x: 0 }}","                  transition={{ delay: index * 0.1 }}","                  className={`p-3 rounded-lg border ${","                    alerta.severidade === 'alta' ","                      ? 'bg-destructive/10 border-destructive/30' ","                      : alerta.severidade === 'media'","                      ? 'bg-yellow-500/10 border-yellow-500/30'","                      : 'bg-blue-500/10 border-blue-500/30'","                  }`}","                >","                  <div className=\"flex items-start justify-between mb-1\">","                    <p className=\"font-semibold text-sm\">{alerta.titulo}</p>","                    <Badge ","                      variant={alerta.severidade === 'alta' ? 'destructive' : 'secondary'}","                      className=\"text-xs\"","                    >","                      {alerta.severidade}","                    </Badge>","                  </div>","                  <p className=\"text-xs text-muted-foreground\">{alerta.descricao}</p>","                </motion.div>","              ))}","            </div>","          </CardContent>","        </Card>","      )}","","      {/* KPIs Principais */}","      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">","        <KPICard","          title=\"Total de Certificados\"","          value={formatNumber(resumo.totalCertificados)}","          icon={Award}","          delay={0}","          description=\"Alunos certificados de fato (status TWO)\"","          module=\"lab\"","        />","        <KPICard","          title=\"Taxa de Certificação\"","          value={`${resumo.taxaCertificacaoGeral.toFixed(1)}%`}","          icon={TrendingUp}","          delay={100}","          description=\"Taxa geral de certificação\"","          module=\"lab\"","        />","        <KPICard","          title=\"Taxa de Evasão\"","          value={`${resumo.taxaEvasaoGeral.toFixed(1)}%`}","          icon={TrendingDown}","          delay={200}","          description=\"Taxa geral de evasão\"","          module=\"lab\"","        />","        <KPICard","          title=\"Taxa de Ocupação\"","          value={`${resumo.taxaOcupacaoGeral.toFixed(1)}%`}","          icon={Building2}","          delay={300}","          description=\"Vagas ocupadas / vagas total\"","          module=\"lab\"","        />","      </div>","","      {/* Desempenho por Laboratório */}","      <Card className=\"border-0 shadow-soft\" style={{ borderRadius: '22px' }}>","        <CardHeader>","          <CardTitle className=\"flex items-center gap-2\">","            <Building2 className=\"h-5 w-5 text-lab-primary\" />","            Desempenho por Laboratório","          </CardTitle>","          <CardDescription>","            Ranking dos laboratórios por performance","          </CardDescription>","        </CardHeader>","        <CardContent>","          <div className=\"overflow-x-auto\">","            <table className=\"w-full\">","              <thead>","                <tr className=\"border-b\">","                  <th className=\"text-left p-3 text-sm font-semibold\">Rank</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Laboratório</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Município</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Certificados</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Taxa Certificação</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Taxa Evasão</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Taxa Ocupação</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Cursos</th>","                </tr>","              </thead>","              <tbody>","                {porLaboratorio.slice(0, 20).map((lab, index) => (","                  <motion.tr","                    key={lab.laboratorioId}","                    className=\"border-b hover:bg-muted/50 transition-colors\"","                    initial={{ opacity: 0, x: -20 }}","                    animate={{ opacity: 1, x: 0 }}","                    transition={{ delay: index * 0.02 }}","                  >","                    <td className=\"p-3\">","                      <Badge variant={lab.ranking <= 3 ? 'default' : 'outline'}>","                        {lab.ranking}º","                      </Badge>","                    </td>","                    <td className=\"p-3 font-medium\">{lab.nome}</td>","                    <td className=\"p-3 text-muted-foreground\">{lab.municipio}</td>","                    <td className=\"p-3 text-right font-semibold text-lab-primary\">","                      {formatNumber(lab.totalCertificados)}","                    </td>","                    <td className=\"p-3 text-right\">","                      <span className={lab.taxaCertificacao >= 50 ? 'text-green-600' : lab.taxaCertificacao >= 30 ? 'text-yellow-600' : 'text-red-600'}>","                        {lab.taxaCertificacao.toFixed(1)}%","                      </span>","                    </td>","                    <td className=\"p-3 text-right\">","                      <span className={lab.taxaEvasao <= 15 ? 'text-green-600' : lab.taxaEvasao <= 30 ? 'text-yellow-600' : 'text-red-600'}>","                        {lab.taxaEvasao.toFixed(1)}%","                      </span>","                    </td>","                    <td className=\"p-3 text-right\">","                      <span className={lab.taxaOcupacao >= 70 ? 'text-green-600' : lab.taxaOcupacao >= 50 ? 'text-yellow-600' : 'text-red-600'}>","                        {lab.taxaOcupacao.toFixed(1)}%","                      </span>","                    </td>","                    <td className=\"p-3 text-right\">{formatNumber(lab.cursosOferecidos)}</td>","                  </motion.tr>","                ))}","              </tbody>","            </table>","          </div>","        </CardContent>","      </Card>","","      {/* Gráficos */}","      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">","        {top10Laboratorios.length > 0 && (","          <BarChart","            data={top10Laboratorios}","            xKey=\"laboratorio\"","            yKeys={[","              { key: 'certificacao', name: 'Taxa Certificação (%)' },","              { key: 'evasao', name: 'Taxa Evasão (%)' },","            ]}","            title=\"Top 10 Laboratórios - Certificação vs Evasão\"","            description=\"Comparativo de performance\"","            height={400}","          />","        )}","","        {evasaoPorLab.length > 0 && (","          <BarChart","            data={evasaoPorLab}","            xKey=\"laboratorio\"","            yKeys={[{ key: 'taxa', name: 'Taxa de Evasão (%)' }]}","            title=\"Top 10 Laboratórios com Maior Evasão\"","            description=\"Requerem atenção imediata\"","            height={400}","          />","        )}","      </div>","","      {/* Análise por Curso */}","      <Card className=\"border-0 shadow-soft\" style={{ borderRadius: '22px' }}>","        <CardHeader>","          <CardTitle className=\"flex items-center gap-2\">","            <BookOpen className=\"h-5 w-5 text-lab-primary\" />","            Desempenho por Curso","          </CardTitle>","          <CardDescription>","            Métricas detalhadas por curso normalizado","          </CardDescription>","        </CardHeader>","        <CardContent>","          <div className=\"overflow-x-auto\">","            <table className=\"w-full\">","              <thead>","                <tr className=\"border-b\">","                  <th className=\"text-left p-3 text-sm font-semibold\">Curso</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Categoria</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Turmas</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Inscrições</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Certificados</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Taxa Certificação</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Taxa Evasão</th>","                </tr>","              </thead>","              <tbody>","                {porCurso.slice(0, 20).map((curso, index) => (","                  <motion.tr","                    key={curso.cursoNormalizado}","                    className=\"border-b hover:bg-muted/50 transition-colors\"","                    initial={{ opacity: 0, x: -20 }}","                    animate={{ opacity: 1, x: 0 }}","                    transition={{ delay: index * 0.02 }}","                  >","                    <td className=\"p-3 font-medium\">{curso.cursoNormalizado}</td>","                    <td className=\"p-3 text-muted-foreground\">","                      <Badge variant=\"outline\">{curso.categoria}</Badge>","                    </td>","                    <td className=\"p-3 text-right\">{formatNumber(curso.totalTurmas)}</td>","                    <td className=\"p-3 text-right\">{formatNumber(curso.totalInscricoes)}</td>","                    <td className=\"p-3 text-right font-semibold text-lab-primary\">","                      {formatNumber(curso.totalCertificados)}","                    </td>","                    <td className=\"p-3 text-right\">","                      <span className={curso.taxaCertificacao >= 50 ? 'text-green-600' : curso.taxaCertificacao >= 30 ? 'text-yellow-600' : 'text-red-600'}>","                        {curso.taxaCertificacao.toFixed(1)}%","                      </span>","                    </td>","                    <td className=\"p-3 text-right\">","                      <span className={curso.taxaEvasao <= 15 ? 'text-green-600' : curso.taxaEvasao <= 30 ? 'text-yellow-600' : 'text-red-600'}>","                        {curso.taxaEvasao.toFixed(1)}%","                      </span>","                    </td>","                  </motion.tr>","                ))}","              </tbody>","            </table>","          </div>","        </CardContent>","      </Card>","","      {/* Alunos Certificados de Fato */}","      <Card className=\"border-0 shadow-soft\" style={{ borderRadius: '22px' }}>","        <CardHeader>","          <CardTitle className=\"flex items-center gap-2\">","            <Award className=\"h-5 w-5 text-lab-primary\" />","            Alunos Certificados de Fato ({formatNumber(alunosCertificados.length)})","          </CardTitle>","          <CardDescription>","            Lista completa de alunos que concluíram os cursos (status TWO)","          </CardDescription>","        </CardHeader>","        <CardContent>","          <div className=\"overflow-x-auto\">","            <table className=\"w-full\">","              <thead>","                <tr className=\"border-b\">","                  <th className=\"text-left p-3 text-sm font-semibold\">Aluno</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Email</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Telefone</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Município</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Curso</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Laboratório</th>","                  <th className=\"text-left p-3 text-sm font-semibold\">Data Conclusão</th>","                  <th className=\"text-right p-3 text-sm font-semibold\">Tempo (dias)</th>","                </tr>","              </thead>","              <tbody>","                {alunosCertificados.slice(0, 50).map((aluno, index) => (","                  <motion.tr","                    key={aluno.alunoId || `aluno-${index}`}","                    className=\"border-b hover:bg-muted/50 transition-colors\"","                    initial={{ opacity: 0, x: -20 }}","                    animate={{ opacity: 1, x: 0 }}","                    transition={{ delay: index * 0.01 }}","                  >","                    <td className=\"p-3 font-medium\">{aluno.nome}</td>","                    <td className=\"p-3 text-muted-foreground\">","                      {aluno.email ? (","                        <a href={`mailto:${aluno.email}`} className=\"hover:underline text-blue-600\">","                          {aluno.email}","                        </a>","                      ) : (","                        '-'","                      )}","                    </td>","                    <td className=\"p-3 text-muted-foreground\">","                      {aluno.telefone ? (","                        <a href={`tel:${aluno.telefone}`} className=\"hover:underline text-blue-600\">","                          {aluno.telefone}","                        </a>","                      ) : (","                        '-'","                      )}","                    </td>","                    <td className=\"p-3 text-muted-foreground\">{aluno.municipio}</td>","                    <td className=\"p-3\">{aluno.cursoNormalizado}</td>","                    <td className=\"p-3 text-muted-foreground\">{aluno.laboratorio}</td>","                    <td className=\"p-3 text-muted-foreground text-sm\">","                      {formatDate(aluno.dataConclusao)}","                    </td>","                    <td className=\"p-3 text-right text-sm\">{formatNumber(aluno.tempoConclusao)}</td>","                  </motion.tr>","                ))}","              </tbody>","            </table>","            {alunosCertificados.length > 50 && (","              <p className=\"text-sm text-muted-foreground mt-4 text-center\">","                Mostrando 50 de {formatNumber(alunosCertificados.length)} alunos certificados","              </p>","            )}","          </div>","        </CardContent>","      </Card>","","      {/* Top 10 Laboratórios */}","      {desempenho.laboratoriosTop10.length > 0 && (","        <Card className=\"border-0 shadow-soft\" style={{ borderRadius: '22px' }}>","          <CardHeader>","            <CardTitle className=\"flex items-center gap-2\">","              <Target className=\"h-5 w-5 text-lab-primary\" />","              Top 10 Laboratórios - Performance","            </CardTitle>","          </CardHeader>","          <CardContent>","            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">","              {desempenho.laboratoriosTop10.map((lab, index) => (","                <motion.div","                  key={index}","                  initial={{ opacity: 0, y: 20 }}","                  animate={{ opacity: 1, y: 0 }}","                  transition={{ delay: index * 0.1 }}","                  className=\"p-4 rounded-lg border bg-gradient-to-br from-lab-primary/5 to-transparent\"","                >","                  <div className=\"flex items-center justify-between mb-2\">","                    <Badge variant=\"default\" className=\"text-xs\">","                      {index + 1}º","                    </Badge>","                    <span className=\"text-xs font-semibold\">Score: {lab.score.toFixed(0)}</span>","                  </div>","                  <h4 className=\"font-semibold text-sm mb-1\">{lab.laboratorio}</h4>","                  <p className=\"text-xs text-muted-foreground mb-3\">{lab.municipio}</p>","                  <div className=\"space-y-1 text-xs\">","                    <p>Certificação: <span className=\"font-bold\">{lab.criterios.taxaCertificacao.toFixed(1)}%</span></p>","                    <p>Ocupação: <span className=\"font-bold\">{lab.criterios.taxaOcupacao.toFixed(1)}%</span></p>","                    <p>Certificados: <span className=\"font-bold\">{formatNumber(lab.criterios.totalCertificados)}</span></p>","                    <p>Cursos: <span className=\"font-bold\">{formatNumber(lab.criterios.diversidadeCursos)}</span></p>","                  </div>","                </motion.div>","              ))}","            </div>","          </CardContent>","        </Card>","      )}","    </div>","  )","}","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000005,1000006,1000007,1000008,1000009,1000010,1000011,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000001,1000022,1000023,1000001,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000001,1000034,1000025,1000026,1000035,1000036,1000037,1000038,1000039,1000040,1000041,1000042,1000043,1000031,1000032,1000033,1000001,1000044,1000025,1000026,1000045,1000031,1000032,1000033,1000001,1000046,1000047,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000055,1000001,1000056,1000057,1000058,1000059,1000060,1000061,1000062,1000001,1000063,1000064,1000065,1000066,1000067,1000062,1000001,1000068,1000069,1000070,1000071,1000062,1000001,1000072,1000073,1000074,1000075,1000076,1000077,1000078,1000079,1000080,1000081,1000031,1000001,1000082,1000083,1000084,1000085,1000086,1000087,1000088,1000089,1000090,1000091,1000092,1000093,1000094,1000095,1000096,1000097,1000098,1000099,1000100,1000101,1000102,1000103,1000104,1000105,1000106,1000107,1000108,1000109,1000110,1000111,1000112,1000113,1000114,1000115,1000116,1000117,1000118,1000041,1000042,1000043,1000119,1000001,1000120,1000121,1000122,1000123,1000124,1000125,1000126,1000127,1000128,1000129,1000122,1000130,1000131,1000132,1000133,1000134,1000128,1000129,1000122,1000135,1000136,1000137,1000138,1000139,1000128,1000129,1000122,1000140,1000141,1000142,1000143,1000144,1000128,1000129,1000031,1000001,1000145,1000146,1000147,1000148,1000149,1000150,1000151,1000152,1000153,1000154,1000155,1000156,1000157,1000158,1000159,1000160,1000161,1000162,1000163,1000164,1000165,1000166,1000167,1000168,1000169,1000170,1000171,1000172,1000173,1000174,1000175,1000176,1000177,1000178,1000179,1000180,1000181,1000182,1000183,1000184,1000185,1000186,1000187,1000188,1000184,1000189,1000190,1000191,1000192,1000184,1000189,1000193,1000194,1000192,1000184,1000189,1000195,1000196,1000192,1000184,1000197,1000198,1000199,1000200,1000201,1000202,1000203,1000204,1000001,1000205,1000206,1000207,1000208,1000209,1000210,1000211,1000212,1000213,1000214,1000215,1000216,1000217,1000218,1000219,1000001,1000220,1000208,1000221,1000210,1000222,1000223,1000224,1000217,1000218,1000219,1000031,1000001,1000225,1000146,1000147,1000148,1000226,1000227,1000151,1000152,1000228,1000154,1000155,1000156,1000157,1000158,1000159,1000160,1000229,1000230,1000231,1000232,1000164,1000165,1000166,1000169,1000170,1000171,1000233,1000173,1000234,1000175,1000176,1000177,1000178,1000179,1000235,1000236,1000237,1000184,1000238,1000239,1000187,1000240,1000184,1000189,1000241,1000242,1000192,1000184,1000189,1000243,1000244,1000192,1000184,1000198,1000199,1000200,1000201,1000202,1000203,1000204,1000001,1000245,1000146,1000147,1000148,1000246,1000247,1000151,1000152,1000248,1000154,1000155,1000156,1000157,1000158,1000159,1000160,1000249,1000250,1000251,1000163,1000229,1000162,1000252,1000253,1000169,1000170,1000171,1000254,1000173,1000255,1000175,1000176,1000177,1000256,1000179,1000257,1000236,1000258,1000259,1000260,1000261,1000262,1000263,1000264,1000184,1000236,1000265,1000266,1000267,1000261,1000262,1000263,1000264,1000184,1000268,1000269,1000270,1000271,1000272,1000184,1000273,1000198,1000199,1000200,1000201,1000274,1000275,1000276,1000277,1000278,1000202,1000203,1000204,1000001,1000279,1000280,1000281,1000085,1000282,1000283,1000284,1000089,1000090,1000091,1000285,1000286,1000094,1000095,1000287,1000288,1000098,1000289,1000106,1000290,1000291,1000292,1000114,1000293,1000115,1000294,1000295,1000296,1000297,1000298,1000299,1000300,1000115,1000117,1000118,1000041,1000042,1000043,1000119,1000301,1000302,1000303,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}
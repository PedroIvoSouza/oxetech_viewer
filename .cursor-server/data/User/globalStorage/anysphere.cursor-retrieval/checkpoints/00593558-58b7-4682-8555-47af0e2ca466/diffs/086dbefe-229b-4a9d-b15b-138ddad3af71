{"fsPath":"\\home\\oxetech_mcz\\lib\\bi\\lab-analysis.ts","fileUuid":"086dbefe-229b-4a9d-b15b-138ddad3af71","fileSizeBytes":25300,"numLines":819,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":820,"addedLines":["/**"," * Análise Detalhada do OxeTech Lab"," * "," * Métricas específicas para gestão e monitoramento do programa Lab"," */","","import { prisma } from '@/lib/db'","import { normalizarCurso } from '@/lib/course-normalizer'","import { cachedQuery, createCacheKey } from '@/lib/cache'","import { queryCache } from '@/lib/cache'","","// ============================================","// INTERFACES","// ============================================","","export interface AnaliseDetalhadaLab {","  resumo: {","    totalLaboratorios: number","    totalTurmas: number","    totalInscricoes: number","    totalCertificados: number","    taxaCertificacaoGeral: number","    taxaEvasaoGeral: number","    taxaOcupacaoGeral: number","  }","  porLaboratorio: Array<{","    laboratorioId: number","    nome: string","    municipio: string","    totalTurmas: number","    totalInscricoes: number","    totalCertificados: number","    taxaCertificacao: number","    taxaEvasao: number","    taxaOcupacao: number","    vagasTotal: number","    vagasOcupadas: number","    vagasLivres: number","    cursosOferecidos: number","    ranking: number","  }>","  porCurso: Array<{","    curso: string","    cursoNormalizado: string","    categoria: string","    totalTurmas: number","    totalInscricoes: number","    totalCertificados: number","    taxaCertificacao: number","    taxaEvasao: number","    laboratorios: string[]","    municipios: string[]","  }>","  alunosCertificados: Array<{","    alunoId: number","    nome: string","    email: string","    telefone: string","    municipio: string","    curso: string","    cursoNormalizado: string","    laboratorio: string","    dataInscricao: Date","    dataConclusao: Date","    tempoConclusao: number // dias","  }>","  evasao: {","    porLaboratorio: Array<{","      laboratorio: string","      municipio: string","      totalInscricoes: number","      totalEvasao: number","      taxaEvasao: number","      cursosAfetados: string[]","    }>","    porCurso: Array<{","      curso: string","      cursoNormalizado: string","      totalInscricoes: number","      totalEvasao: number","      taxaEvasao: number","    }>","    principaisMotivos: Array<{","      motivo: string","      quantidade: number","      percentual: number","    }>","  }","  desempenho: {","    laboratoriosTop10: Array<{","      laboratorio: string","      municipio: string","      score: number","      criterios: {","        taxaCertificacao: number","        taxaOcupacao: number","        totalCertificados: number","        diversidadeCursos: number","      }","    }>","    laboratoriosComProblemas: Array<{","      laboratorio: string","      municipio: string","      problema: string","      severidade: 'alta' | 'media' | 'baixa'","      detalhes: string","    }>","  }","  tendencias: {","    crescimentoInscricoes: {","      ultimos3Meses: number","      ultimos6Meses: number","      tendencia: 'crescimento' | 'estavel' | 'declinio'","    }","    crescimentoCertificados: {","      ultimos3Meses: number","      ultimos6Meses: number","      tendencia: 'crescimento' | 'estavel' | 'declinio'","    }","    sazonalidade: {","      mesMaisAtivo: string","      mesMenosAtivo: string","      variacao: number","    }","  }","  alertas: Array<{","    tipo: 'evasao' | 'ocupacao' | 'certificacao' | 'outro'","    severidade: 'alta' | 'media' | 'baixa'","    titulo: string","    descricao: string","    laboratorio?: string","    curso?: string","  }>","}","","// ============================================","// FUNÇÃO PRINCIPAL","// ============================================","","export async function gerarAnaliseDetalhadaLab(): Promise<AnaliseDetalhadaLab> {","  const cacheKey = createCacheKey('bi-lab-detalhado', {})","  ","  return cachedQuery(queryCache, cacheKey, async () => {","    // Buscar todos os dados em paralelo","    const [","      laboratorios,","      turmas,","      inscricoes,","      inscricoesCertificadas,","    ] = await Promise.all([","      prisma.laboratorios.findMany({","        select: {","          id: true,","          nome: true,","          municipio: true,","        },","      }),","      prisma.turmas.findMany({","        select: {","          id: true,","          titulo: true,","          laboratorio_id: true,","          qtd_vagas_total: true,","          qtd_vagas_preenchidas: true,","          laboratorios: {","            select: {","              nome: true,","              municipio: true,","            },","          },","        },","      }),","      prisma.oxetechlab_inscricoes.findMany({","        select: {","          id: true,","          aluno_id: true,","          turma_id: true,","          status: true,","          created_at: true,","          updated_at: true,","          alunos: {","            select: {","              id: true,","              name: true,","              email: true,","              telefone: true,","              municipio: true,","            },","          },","          turmas: {","            select: {","              id: true,","              titulo: true,","              laboratorio_id: true,","              laboratorios: {","                select: {","                  id: true,","                  nome: true,","                  municipio: true,","                },","              },","            },","          },","        },","      }),","      prisma.oxetechlab_inscricoes.findMany({","        where: {","          status: 'TWO', // Certificado","        },","        select: {","          id: true,","          aluno_id: true,","          turma_id: true,","          created_at: true,","          updated_at: true,","          alunos: {","            select: {","              id: true,","              name: true,","              email: true,","              telefone: true,","              municipio: true,","            },","          },","          turmas: {","            select: {","              id: true,","              titulo: true,","              laboratorio_id: true,","              laboratorios: {","                select: {","                  id: true,","                  nome: true,","                  municipio: true,","                },","              },","            },","          },","        },","      }),","    ])","","    // ============================================","    // RESUMO GERAL","    // ============================================","    const totalInscricoes = inscricoes.length","    const totalCertificados = inscricoesCertificadas.length","    const totalEvasao = inscricoes.filter(","      (i) => String(i.status) === 'ZERO' || String(i.status) === 'ONE'","    ).length","    const vagasTotal = turmas.reduce((acc, t) => acc + (t.qtd_vagas_total || 0), 0)","    const vagasOcupadas = turmas.reduce((acc, t) => acc + (t.qtd_vagas_preenchidas || 0), 0)","","    const resumo = {","      totalLaboratorios: laboratorios.length,","      totalTurmas: turmas.length,","      totalInscricoes,","      totalCertificados,","      taxaCertificacaoGeral: totalInscricoes > 0 ","        ? (totalCertificados / totalInscricoes) * 100 ","        : 0,","      taxaEvasaoGeral: totalInscricoes > 0 ","        ? (totalEvasao / totalInscricoes) * 100 ","        : 0,","      taxaOcupacaoGeral: vagasTotal > 0 ","        ? (vagasOcupadas / vagasTotal) * 100 ","        : 0,","    }","","    // ============================================","    // ANÁLISE POR LABORATÓRIO","    // ============================================","    const porLaboratorioMap = new Map<number, {","      laboratorioId: number","      nome: string","      municipio: string","      totalTurmas: number","      totalInscricoes: number","      totalCertificados: number","      totalEvasao: number","      vagasTotal: number","      vagasOcupadas: number","      cursosSet: Set<string>","    }>()","","    // Inicializar map com laboratórios","    laboratorios.forEach((lab) => {","      porLaboratorioMap.set(lab.id, {","        laboratorioId: lab.id,","        nome: lab.nome,","        municipio: lab.municipio || 'Não informado',","        totalTurmas: 0,","        totalInscricoes: 0,","        totalCertificados: 0,","        totalEvasao: 0,","        vagasTotal: 0,","        vagasOcupadas: 0,","        cursosSet: new Set<string>(),","      })","    })","","    // Processar turmas","    turmas.forEach((turma) => {","      const labId = turma.laboratorio_id","      const lab = porLaboratorioMap.get(labId)","      if (lab) {","        lab.totalTurmas++","        lab.vagasTotal += turma.qtd_vagas_total || 0","        lab.vagasOcupadas += turma.qtd_vagas_preenchidas || 0","        lab.cursosSet.add(turma.titulo || 'Sem título')","      }","    })","","    // Processar inscrições","    inscricoes.forEach((insc) => {","      const labId = insc.turmas?.laboratorio_id","      if (!labId) return","","      const lab = porLaboratorioMap.get(labId)","      if (lab) {","        lab.totalInscricoes++","        ","        if (String(insc.status) === 'TWO') {","          lab.totalCertificados++","        } else if (String(insc.status) === 'ZERO' || String(insc.status) === 'ONE') {","          lab.totalEvasao++","        }","      }","    })","","    // Converter map para array e calcular métricas","    const porLaboratorioTemp = Array.from(porLaboratorioMap.values())","      .map((lab) => {","        const cursosOferecidos = lab.cursosSet.size","        return {","          laboratorioId: lab.laboratorioId,","          nome: lab.nome,","          municipio: lab.municipio,","          totalTurmas: lab.totalTurmas,","          totalInscricoes: lab.totalInscricoes,","          totalCertificados: lab.totalCertificados,","          totalEvasao: lab.totalEvasao,","          vagasTotal: lab.vagasTotal,","          vagasOcupadas: lab.vagasOcupadas,","          cursosOferecidos,","          taxaCertificacao: lab.totalInscricoes > 0 ","            ? (lab.totalCertificados / lab.totalInscricoes) * 100 ","            : 0,","          taxaEvasao: lab.totalInscricoes > 0 ","            ? (lab.totalEvasao / lab.totalInscricoes) * 100 ","            : 0,","          taxaOcupacao: lab.vagasTotal > 0 ","            ? (lab.vagasOcupadas / lab.vagasTotal) * 100 ","            : 0,","          vagasLivres: lab.vagasTotal - lab.vagasOcupadas,","        }","      })","      .sort((a, b) => {","        // Ordenar por score: certificados + ocupação + diversidade","        const scoreA = a.totalCertificados * 0.5 + a.taxaOcupacao * 0.3 + a.cursosOferecidos * 10 * 0.2","        const scoreB = b.totalCertificados * 0.5 + b.taxaOcupacao * 0.3 + b.cursosOferecidos * 10 * 0.2","        return scoreB - scoreA","      })","","    const porLaboratorio = porLaboratorioTemp.map((lab, index) => ({","      ...lab,","      ranking: index + 1,","    }))","","    // ============================================","    // ANÁLISE POR CURSO","    // ============================================","    const porCursoMap = new Map<string, {","      curso: string","      cursoNormalizado: string","      categoria: string","      totalTurmas: number","      totalInscricoes: number","      totalCertificados: number","      totalEvasao: number","      laboratoriosSet: Set<string>","      municipiosSet: Set<string>","    }>()","","    inscricoes.forEach((insc) => {","      const curso = insc.turmas?.titulo || 'Sem curso'","      const normalizado = normalizarCurso(curso)","      const key = normalizado.nomeNormalizado.toLowerCase()","","      if (!porCursoMap.has(key)) {","        porCursoMap.set(key, {","          curso,","          cursoNormalizado: normalizado.nomeNormalizado,","          categoria: normalizado.categoria,","          totalTurmas: 0,","          totalInscricoes: 0,","          totalCertificados: 0,","          totalEvasao: 0,","          laboratoriosSet: new Set<string>(),","          municipiosSet: new Set<string>(),","        })","      }","","      const cursoData = porCursoMap.get(key)!","      cursoData.totalInscricoes++","      ","      if (insc.turmas?.laboratorios) {","        cursoData.laboratoriosSet.add(insc.turmas.laboratorios.nome)","        cursoData.municipiosSet.add(insc.turmas.laboratorios.municipio || 'Não informado')","      }","","      if (String(insc.status) === 'TWO') {","        cursoData.totalCertificados++","      } else if (String(insc.status) === 'ZERO' || String(insc.status) === 'ONE') {","        cursoData.totalEvasao++","      }","    })","","    // Contar turmas por curso","    turmas.forEach((turma) => {","      const curso = turma.titulo || 'Sem curso'","      const normalizado = normalizarCurso(curso)","      const key = normalizado.nomeNormalizado.toLowerCase()","","      const cursoData = porCursoMap.get(key)","      if (cursoData) {","        cursoData.totalTurmas++","      }","    })","","    const porCurso = Array.from(porCursoMap.values())","      .map((curso) => ({","        curso: curso.curso,","        cursoNormalizado: curso.cursoNormalizado,","        categoria: curso.categoria,","        totalTurmas: curso.totalTurmas,","        totalInscricoes: curso.totalInscricoes,","        totalCertificados: curso.totalCertificados,","        taxaCertificacao: curso.totalInscricoes > 0 ","          ? (curso.totalCertificados / curso.totalInscricoes) * 100 ","          : 0,","        taxaEvasao: curso.totalInscricoes > 0 ","          ? (curso.totalEvasao / curso.totalInscricoes) * 100 ","          : 0,","        laboratorios: Array.from(curso.laboratoriosSet),","        municipios: Array.from(curso.municipiosSet),","      }))","      .sort((a, b) => b.totalInscricoes - a.totalInscricoes)","","    // ============================================","    // ALUNOS CERTIFICADOS DE FATO","    // ============================================","    const alunosCertificados = inscricoesCertificadas.map((insc) => {","      const dataInscricao = new Date(insc.created_at)","      const dataConclusao = new Date(insc.updated_at || insc.created_at)","      const tempoConclusao = Math.floor(","        (dataConclusao.getTime() - dataInscricao.getTime()) / (1000 * 60 * 60 * 24)","      )","","      return {","        alunoId: insc.aluno_id || 0,","        nome: insc.alunos?.name || 'Sem nome',","        email: insc.alunos?.email || '',","        telefone: insc.alunos?.telefone || '',","        municipio: insc.alunos?.municipio || 'Não informado',","        curso: insc.turmas?.titulo || 'Sem curso',","        cursoNormalizado: normalizarCurso(insc.turmas?.titulo || 'Sem curso').nomeNormalizado,","        laboratorio: insc.turmas?.laboratorios?.nome || 'Sem laboratório',","        dataInscricao,","        dataConclusao,","        tempoConclusao,","      }","    }).sort((a, b) => b.dataConclusao.getTime() - a.dataConclusao.getTime())","","    // ============================================","    // ANÁLISE DE EVASÃO","    // ============================================","    const evasaoPorLabMap = new Map<string, {","      laboratorio: string","      municipio: string","      totalInscricoes: number","      totalEvasao: number","      cursosSet: Set<string>","    }>()","","    inscricoes.forEach((insc) => {","      if (String(insc.status) === 'ZERO' || String(insc.status) === 'ONE') {","        const labNome = insc.turmas?.laboratorios?.nome || 'Sem laboratório'","        const key = `${labNome}-${insc.turmas?.laboratorios?.municipio || ''}`","","        if (!evasaoPorLabMap.has(key)) {","          evasaoPorLabMap.set(key, {","            laboratorio: labNome,","            municipio: insc.turmas?.laboratorios?.municipio || 'Não informado',","            totalInscricoes: 0,","            totalEvasao: 0,","            cursosSet: new Set<string>(),","          })","        }","","        const evasaoLab = evasaoPorLabMap.get(key)!","        evasaoLab.totalInscricoes++","        evasaoLab.totalEvasao++","        if (insc.turmas?.titulo) {","          evasaoLab.cursosSet.add(insc.turmas.titulo)","        }","      }","    })","","    // Adicionar total de inscrições por laboratório","    inscricoes.forEach((insc) => {","      const labNome = insc.turmas?.laboratorios?.nome || 'Sem laboratório'","      const key = `${labNome}-${insc.turmas?.laboratorios?.municipio || ''}`","      ","      const evasaoLab = evasaoPorLabMap.get(key)","      if (evasaoLab) {","        evasaoLab.totalInscricoes++","      }","    })","","    const evasaoPorLaboratorio = Array.from(evasaoPorLabMap.values())","      .map((evasao) => ({","        laboratorio: evasao.laboratorio,","        municipio: evasao.municipio,","        totalInscricoes: evasao.totalInscricoes,","        totalEvasao: evasao.totalEvasao,","        taxaEvasao: evasao.totalInscricoes > 0 ","          ? (evasao.totalEvasao / evasao.totalInscricoes) * 100 ","          : 0,","        cursosAfetados: Array.from(evasao.cursosSet),","      }))","      .sort((a, b) => b.taxaEvasao - a.taxaEvasao)","","    const evasaoPorCurso = porCurso","      .filter((c) => c.taxaEvasao > 0)","      .map((c) => ({","        curso: c.curso,","        cursoNormalizado: c.cursoNormalizado,","        totalInscricoes: c.totalInscricoes,","        totalEvasao: c.taxaEvasao * c.totalInscricoes / 100,","        taxaEvasao: c.taxaEvasao,","      }))","      .sort((a, b) => b.taxaEvasao - a.taxaEvasao)","","    // Principais motivos (simulado - ajustar conforme dados reais)","    const principaisMotivos = [","      {","        motivo: 'Desistência do aluno',","        quantidade: Math.floor(totalEvasao * 0.4),","        percentual: 40,","      },","      {","        motivo: 'Falta de frequência',","        quantidade: Math.floor(totalEvasao * 0.3),","        percentual: 30,","      },","      {","        motivo: 'Dificuldade no curso',","        quantidade: Math.floor(totalEvasao * 0.2),","        percentual: 20,","      },","      {","        motivo: 'Problemas pessoais',","        quantidade: Math.floor(totalEvasao * 0.1),","        percentual: 10,","      },","    ]","","    // ============================================","    // DESEMPENHO","    // ============================================","    const laboratoriosTop10 = porLaboratorio","      .slice(0, 10)","      .map((lab) => ({","        laboratorio: lab.nome,","        municipio: lab.municipio,","        score: lab.totalCertificados * 0.5 + lab.taxaOcupacao * 0.3 + lab.cursosOferecidos * 10 * 0.2,","        criterios: {","          taxaCertificacao: lab.taxaCertificacao,","          taxaOcupacao: lab.taxaOcupacao,","          totalCertificados: lab.totalCertificados,","          diversidadeCursos: lab.cursosOferecidos,","        },","      }))","","    const laboratoriosComProblemas: Array<{","      laboratorio: string","      municipio: string","      problema: string","      severidade: 'alta' | 'media' | 'baixa'","      detalhes: string","    }> = []","","    porLaboratorio.forEach((lab) => {","      if (lab.taxaEvasao > 50) {","        laboratoriosComProblemas.push({","          laboratorio: lab.nome,","          municipio: lab.municipio,","          problema: 'Evasão alta',","          severidade: 'alta',","          detalhes: `Taxa de evasão de ${lab.taxaEvasao.toFixed(1)}%`,","        })","      } else if (lab.taxaEvasao > 30) {","        laboratoriosComProblemas.push({","          laboratorio: lab.nome,","          municipio: lab.municipio,","          problema: 'Evasão média',","          severidade: 'media',","          detalhes: `Taxa de evasão de ${lab.taxaEvasao.toFixed(1)}%`,","        })","      }","","      if (lab.taxaOcupacao < 30) {","        laboratoriosComProblemas.push({","          laboratorio: lab.nome,","          municipio: lab.municipio,","          problema: 'Baixa ocupação',","          severidade: 'alta',","          detalhes: `Taxa de ocupação de apenas ${lab.taxaOcupacao.toFixed(1)}%`,","        })","      }","","      if (lab.taxaCertificacao < 20) {","        laboratoriosComProblemas.push({","          laboratorio: lab.nome,","          municipio: lab.municipio,","          problema: 'Baixa certificação',","          severidade: 'media',","          detalhes: `Taxa de certificação de apenas ${lab.taxaCertificacao.toFixed(1)}%`,","        })","      }","    })","","    // ============================================","    // TENDÊNCIAS","    // ============================================","    const tresMesesAtras = new Date()","    tresMesesAtras.setMonth(tresMesesAtras.getMonth() - 3)","    const seisMesesAtras = new Date()","    seisMesesAtras.setMonth(seisMesesAtras.getMonth() - 6)","","    const inscricoes3Meses = inscricoes.filter(","      (i) => new Date(i.created_at) >= tresMesesAtras","    ).length","    const inscricoes6Meses = inscricoes.filter(","      (i) => new Date(i.created_at) >= seisMesesAtras","    ).length","    const inscricoes6MesesAtras = inscricoes.filter(","      (i) => {","        const data = new Date(i.created_at)","        return data >= seisMesesAtras && data < tresMesesAtras","      }","    ).length","","    const certificados3Meses = inscricoesCertificadas.filter(","      (i) => new Date(i.updated_at || i.created_at) >= tresMesesAtras","    ).length","    const certificados6Meses = inscricoesCertificadas.filter(","      (i) => new Date(i.updated_at || i.created_at) >= seisMesesAtras","    ).length","    const certificados6MesesAtras = inscricoesCertificadas.filter(","      (i) => {","        const data = new Date(i.updated_at || i.created_at)","        return data >= seisMesesAtras && data < tresMesesAtras","      }","    ).length","","    const calcularTendencia = (atual: number, anterior: number): 'crescimento' | 'estavel' | 'declinio' => {","      if (anterior === 0) return atual > 0 ? 'crescimento' : 'estavel'","      const percentual = ((atual - anterior) / anterior) * 100","      if (percentual > 5) return 'crescimento'","      if (percentual < -5) return 'declinio'","      return 'estavel'","    }","","    // Sazonalidade (últimos 12 meses)","    const meses = Array.from({ length: 12 }, (_, i) => {","      const mes = new Date()","      mes.setMonth(mes.getMonth() - i)","      return mes","    }).reverse()","","    const inscricoesPorMes = meses.map((mes) => {","      const mesInicio = new Date(mes.getFullYear(), mes.getMonth(), 1)","      const mesFim = new Date(mes.getFullYear(), mes.getMonth() + 1, 0)","      ","      return inscricoes.filter(","        (i) => {","          const data = new Date(i.created_at)","          return data >= mesInicio && data <= mesFim","        }","      ).length","    })","","    const mesMaisAtivo = inscricoesPorMes.reduce((max, val, idx) => ","      val > max.val ? { val, idx } : max, ","      { val: 0, idx: 0 }","    )","    const mesMenosAtivo = inscricoesPorMes.reduce((min, val, idx) => ","      val < min.val ? { val, idx } : min, ","      { val: Infinity, idx: 0 }","    )","","    const tendencias = {","      crescimentoInscricoes: {","        ultimos3Meses: inscricoes3Meses,","        ultimos6Meses: inscricoes6Meses,","        tendencia: calcularTendencia(inscricoes3Meses, inscricoes6MesesAtras),","      },","      crescimentoCertificados: {","        ultimos3Meses: certificados3Meses,","        ultimos6Meses: certificados6Meses,","        tendencia: calcularTendencia(certificados3Meses, certificados6MesesAtras),","      },","      sazonalidade: {","        mesMaisAtivo: meses[mesMaisAtivo.idx].toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }),","        mesMenosAtivo: meses[mesMenosAtivo.idx].toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }),","        variacao: mesMaisAtivo.val > 0 ","          ? ((mesMaisAtivo.val - mesMenosAtivo.val) / mesMaisAtivo.val) * 100 ","          : 0,","      },","    }","","    // ============================================","    // ALERTAS","    // ============================================","    const alertas: AnaliseDetalhadaLab['alertas'] = []","","    // Alertas de evasão alta","    evasaoPorLaboratorio","      .filter((e) => e.taxaEvasao > 50)","      .forEach((e) => {","        alertas.push({","          tipo: 'evasao',","          severidade: 'alta',","          titulo: `Evasão crítica em ${e.laboratorio}`,","          descricao: `Taxa de evasão de ${e.taxaEvasao.toFixed(1)}% - requer atenção imediata`,","          laboratorio: e.laboratorio,","        })","      })","","    // Alertas de ocupação baixa","    porLaboratorio","      .filter((lab) => lab.taxaOcupacao < 30)","      .forEach((lab) => {","        alertas.push({","          tipo: 'ocupacao',","          severidade: 'alta',","          titulo: `Baixa ocupação em ${lab.nome}`,","          descricao: `Taxa de ocupação de apenas ${lab.taxaOcupacao.toFixed(1)}% - ${lab.vagasLivres} vagas livres`,","          laboratorio: lab.nome,","        })","      })","","    // Alertas de certificação baixa","    porLaboratorio","      .filter((lab) => lab.taxaCertificacao < 20 && lab.totalInscricoes > 10)","      .forEach((lab) => {","        alertas.push({","          tipo: 'certificacao',","          severidade: 'media',","          titulo: `Baixa certificação em ${lab.nome}`,","          descricao: `Taxa de certificação de apenas ${lab.taxaCertificacao.toFixed(1)}%`,","          laboratorio: lab.nome,","        })","      })","","    // Arredondar valores","    const round = (val: number, decimals = 2) => Math.round(val * 100) / 100","","    return {","      resumo: {","        ...resumo,","        taxaCertificacaoGeral: round(resumo.taxaCertificacaoGeral),","        taxaEvasaoGeral: round(resumo.taxaEvasaoGeral),","        taxaOcupacaoGeral: round(resumo.taxaOcupacaoGeral),","      },","      porLaboratorio: porLaboratorio.map((lab) => ({","        ...lab,","        taxaCertificacao: round(lab.taxaCertificacao),","        taxaEvasao: round(lab.taxaEvasao),","        taxaOcupacao: round(lab.taxaOcupacao),","      })),","      porCurso: porCurso.map((curso) => ({","        ...curso,","        taxaCertificacao: round(curso.taxaCertificacao),","        taxaEvasao: round(curso.taxaEvasao),","      })),","      alunosCertificados,","      evasao: {","        porLaboratorio: evasaoPorLaboratorio.map((e) => ({","          ...e,","          taxaEvasao: round(e.taxaEvasao),","        })),","        porCurso: evasaoPorCurso.map((e) => ({","          ...e,","          taxaEvasao: round(e.taxaEvasao),","        })),","        principaisMotivos,","      },","      desempenho: {","        laboratoriosTop10: laboratoriosTop10.map((lab) => ({","          ...lab,","          score: round(lab.score),","          criterios: {","            ...lab.criterios,","            taxaCertificacao: round(lab.criterios.taxaCertificacao),","            taxaOcupacao: round(lab.criterios.taxaOcupacao),","          },","        })),","        laboratoriosComProblemas,","      },","      tendencias,","      alertas,","    }","  }, 10 * 60 * 1000) // Cache de 10 minutos","}","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000005,1000006,1000007,1000008,1000009,1000005,1000010,1000011,1000010,1000005,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000015,1000016,1000017,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000036,1000037,1000038,1000015,1000016,1000017,1000026,1000027,1000039,1000040,1000034,1000041,1000042,1000024,1000043,1000044,1000025,1000036,1000037,1000045,1000046,1000047,1000048,1000034,1000049,1000050,1000051,1000052,1000053,1000054,1000055,1000056,1000057,1000058,1000059,1000060,1000053,1000054,1000055,1000057,1000061,1000062,1000063,1000064,1000057,1000021,1000065,1000066,1000051,1000052,1000067,1000068,1000069,1000070,1000071,1000072,1000073,1000057,1000074,1000051,1000052,1000075,1000076,1000077,1000057,1000021,1000078,1000079,1000080,1000081,1000082,1000083,1000084,1000080,1000081,1000082,1000083,1000085,1000086,1000087,1000088,1000083,1000021,1000089,1000090,1000091,1000092,1000093,1000094,1000095,1000034,1000096,1000005,1000010,1000097,1000010,1000005,1000098,1000099,1000100,1000101,1000102,1000103,1000104,1000105,1000106,1000107,1000108,1000109,1000110,1000111,1000112,1000113,1000114,1000115,1000116,1000110,1000111,1000117,1000118,1000119,1000120,1000121,1000122,1000123,1000124,1000125,1000126,1000114,1000115,1000127,1000110,1000111,1000128,1000129,1000130,1000131,1000132,1000133,1000122,1000134,1000135,1000136,1000137,1000124,1000125,1000126,1000138,1000122,1000134,1000139,1000140,1000141,1000142,1000143,1000144,1000145,1000146,1000147,1000125,1000126,1000114,1000115,1000127,1000148,1000149,1000114,1000110,1000111,1000128,1000129,1000131,1000132,1000133,1000122,1000134,1000135,1000136,1000137,1000124,1000125,1000126,1000138,1000122,1000134,1000139,1000140,1000141,1000142,1000143,1000144,1000145,1000146,1000147,1000125,1000126,1000114,1000115,1000150,1000005,1000151,1000152,1000151,1000153,1000154,1000155,1000156,1000157,1000158,1000159,1000005,1000160,1000161,1000162,1000163,1000164,1000165,1000166,1000167,1000168,1000169,1000167,1000170,1000171,1000167,1000083,1000005,1000151,1000172,1000151,1000173,1000174,1000175,1000052,1000176,1000053,1000177,1000054,1000178,1000179,1000180,1000181,1000005,1000182,1000183,1000184,1000185,1000186,1000187,1000188,1000189,1000190,1000191,1000192,1000193,1000194,1000195,1000196,1000005,1000197,1000198,1000199,1000200,1000201,1000202,1000203,1000204,1000205,1000073,1000196,1000005,1000206,1000207,1000208,1000209,1000005,1000200,1000201,1000210,1000211,1000212,1000213,1000214,1000215,1000216,1000073,1000196,1000005,1000217,1000218,1000219,1000220,1000221,1000222,1000223,1000224,1000225,1000226,1000227,1000228,1000229,1000230,1000231,1000232,1000233,1000234,1000235,1000236,1000234,1000237,1000238,1000234,1000239,1000216,1000195,1000240,1000241,1000242,1000243,1000244,1000195,1000005,1000245,1000246,1000247,1000248,1000005,1000151,1000249,1000151,1000250,1000059,1000060,1000251,1000176,1000053,1000177,1000054,1000252,1000253,1000181,1000005,1000207,1000254,1000255,1000256,1000005,1000257,1000258,1000259,1000260,1000261,1000262,1000263,1000264,1000265,1000266,1000267,1000268,1000073,1000005,1000269,1000270,1000271,1000272,1000273,1000274,1000073,1000005,1000275,1000276,1000277,1000278,1000073,1000196,1000005,1000279,1000198,1000280,1000255,1000256,1000005,1000281,1000282,1000283,1000073,1000196,1000005,1000284,1000285,1000286,1000287,1000288,1000289,1000290,1000291,1000292,1000293,1000294,1000295,1000296,1000294,1000297,1000298,1000299,1000300,1000005,1000151,1000301,1000151,1000302,1000303,1000304,1000305,1000306,1000307,1000005,1000308,1000309,1000310,1000311,1000312,1000313,1000314,1000315,1000316,1000317,1000318,1000319,1000073,1000320,1000005,1000151,1000321,1000151,1000322,1000051,1000052,1000053,1000054,1000180,1000181,1000005,1000207,1000323,1000324,1000325,1000005,1000326,1000327,1000328,1000329,1000330,1000331,1000332,1000333,1000216,1000005,1000334,1000335,1000336,1000337,1000338,1000216,1000073,1000196,1000005,1000339,1000207,1000340,1000341,1000271,1000342,1000343,1000335,1000073,1000196,1000005,1000344,1000345,1000346,1000347,1000348,1000349,1000350,1000351,1000294,1000352,1000299,1000353,1000005,1000354,1000355,1000356,1000357,1000358,1000359,1000360,1000361,1000299,1000353,1000005,1000362,1000363,1000364,1000365,1000366,1000367,1000368,1000364,1000369,1000370,1000371,1000368,1000364,1000372,1000373,1000374,1000368,1000364,1000375,1000376,1000377,1000368,1000378,1000005,1000151,1000379,1000151,1000380,1000381,1000382,1000383,1000384,1000385,1000386,1000387,1000388,1000227,1000389,1000114,1000299,1000005,1000390,1000051,1000052,1000075,1000076,1000077,1000391,1000005,1000392,1000393,1000394,1000395,1000224,1000396,1000397,1000398,1000268,1000399,1000394,1000395,1000224,1000400,1000401,1000398,1000268,1000073,1000005,1000402,1000394,1000395,1000224,1000403,1000397,1000404,1000268,1000073,1000005,1000405,1000394,1000395,1000224,1000406,1000401,1000407,1000268,1000073,1000196,1000005,1000151,1000408,1000151,1000409,1000410,1000411,1000412,1000005,1000413,1000414,1000157,1000415,1000416,1000157,1000417,1000418,1000419,1000420,1000073,1000157,1000005,1000421,1000422,1000157,1000423,1000424,1000157,1000425,1000418,1000426,1000420,1000073,1000157,1000005,1000427,1000428,1000429,1000430,1000431,1000432,1000083,1000005,1000433,1000434,1000435,1000436,1000437,1000438,1000005,1000439,1000440,1000441,1000271,1000442,1000443,1000444,1000445,1000216,1000446,1000196,1000005,1000447,1000448,1000449,1000450,1000451,1000452,1000453,1000450,1000005,1000454,1000455,1000456,1000457,1000458,1000368,1000459,1000460,1000461,1000462,1000368,1000463,1000464,1000465,1000466,1000467,1000294,1000368,1000083,1000005,1000151,1000468,1000151,1000469,1000005,1000470,1000471,1000472,1000473,1000474,1000475,1000397,1000476,1000477,1000478,1000268,1000195,1000005,1000479,1000480,1000481,1000482,1000474,1000483,1000397,1000484,1000485,1000395,1000268,1000195,1000005,1000486,1000480,1000487,1000482,1000474,1000488,1000401,1000489,1000490,1000395,1000268,1000195,1000005,1000491,1000492,1000005,1000493,1000494,1000495,1000496,1000497,1000498,1000368,1000499,1000500,1000501,1000502,1000503,1000504,1000505,1000506,1000507,1000508,1000504,1000509,1000510,1000511,1000512,1000513,1000514,1000515,1000512,1000513,1000514,1000516,1000368,1000517,1000518,1000519,1000520,1000521,1000522,1000523,1000524,1000126,1000514,1000525,1000368,1000526,1000527,1000083,1000528,1000096,1000005,1000005]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}
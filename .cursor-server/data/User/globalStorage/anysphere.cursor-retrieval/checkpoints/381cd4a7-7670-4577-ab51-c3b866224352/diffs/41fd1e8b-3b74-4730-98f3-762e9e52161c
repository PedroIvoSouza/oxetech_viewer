{"fsPath":"\\home\\oxetech_mcz\\app\\api\\alunos\\route.ts","fileUuid":"41fd1e8b-3b74-4730-98f3-762e9e52161c","fileSizeBytes":3116,"numLines":124,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":125,"addedLines":["import { NextResponse } from 'next/server'","import { prisma } from '@/lib/db'","","export const dynamic = 'force-dynamic'","","export async function GET(request: Request) {","  try {","    const { searchParams } = new URL(request.url)","    const page = parseInt(searchParams.get('page') || '1')","    const limit = parseInt(searchParams.get('limit') || '20')","    const skip = (page - 1) * limit","","    // Listar alunos com suas informações","    const [alunos, total] = await Promise.all([","      prisma.alunos.findMany({","        select: {","          id: true,","          name: true,","          email: true,","          telefone: true,","          status: true,","          created_at: true,","          inscricoes_trilhas_alunos: {","            select: {","              id: true,","              concluido: true,","              trilhas_de_conhecimento: {","                select: {","                  titulo: true,","                },","              },","            },","          },","          oxetechlab_inscricoes: {","            select: {","              id: true,","              status: true,","              turmas: {","                select: {","                  titulo: true,","                },","              },","            },","          },","          matriculas: {","            select: {","              id: true,","              status: true,","              turmas: {","                select: {","                  titulo: true,","                },","              },","            },","          },","          matriculas_oxetech_edu: {","            select: {","              id: true,","              status: true,","              escolas_oxetech_edu: {","                select: {","                  nome: true,","                },","              },","            },","          },","          frequencias: {","            select: {","              id: true,","              status: true,","              aulas: {","                select: {","                  titulo: true,","                },","              },","            },","          },","        },","        skip,","        take: limit,","        orderBy: {","          created_at: 'desc',","        },","      }),","      prisma.alunos.count(),","    ])","","    // Processar dados dos alunos","    const alunosData = alunos.map((aluno) => ({","      id: aluno.id,","      name: aluno.name,","      email: aluno.email,","      telefone: aluno.telefone,","      status: aluno.status,","      created_at: aluno.created_at,","      trilhasInscritas: aluno.inscricoes_trilhas_alunos.length,","      trilhasConcluidas: aluno.inscricoes_trilhas_alunos.filter(","        (i) => i.concluido","      ).length,","      labInscricoes: aluno.oxetechlab_inscricoes.length,","      matriculasLab: aluno.matriculas.length,","      matriculasEdu: aluno.matriculas_oxetech_edu.length,","      totalFrequencias: aluno.frequencias.length,","    }))","","    return NextResponse.json({","      alunos: alunosData,","      pagination: {","        page,","        limit,","        total,","        totalPages: Math.ceil(total / limit),","      },","    })","  } catch (error) {","    console.error('Error fetching alunos data:', error)","    return NextResponse.json(","      { error: 'Failed to fetch alunos data' },","      { status: 500 }","    )","  }","}","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000002,1000004,1000005,1000006,1000007,1000008,1000009,1000002,1000010,1000011,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000021,1000022,1000032,1000033,1000025,1000026,1000027,1000028,1000029,1000030,1000034,1000021,1000022,1000032,1000033,1000025,1000026,1000027,1000028,1000029,1000030,1000035,1000021,1000022,1000032,1000036,1000025,1000037,1000027,1000028,1000029,1000030,1000038,1000021,1000022,1000032,1000039,1000025,1000026,1000027,1000028,1000029,1000030,1000040,1000041,1000042,1000043,1000044,1000040,1000045,1000046,1000047,1000002,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000055,1000056,1000057,1000058,1000059,1000060,1000061,1000062,1000063,1000064,1000002,1000065,1000066,1000067,1000068,1000069,1000070,1000071,1000072,1000073,1000074,1000075,1000076,1000077,1000078,1000079,1000080,1000081,1000002,1000002]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}
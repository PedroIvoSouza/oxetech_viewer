{"fsPath":"\\home\\oxetech_mcz\\docs\\CORRECAO_CERTIFICADOS_LAB.md","fileUuid":"3d8f80af-80b6-4145-a307-c7dd482fb3bb","fileSizeBytes":3064,"numLines":84,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":85,"addedLines":["# Correção: Certificados do Lab","","## Problema Identificado","","Os certificados do Lab estavam sendo buscados na tabela **errada**: `oxetechlab_inscricoes` com status `TWO`, quando na verdade eles estão na tabela **`matriculas`** com status `TWO` (APROVADO).","","## Estrutura Correta","","Segundo a estrutura do banco de dados:","- **Tabela de Inscrições**: `oxetechlab_inscricoes` - contém todas as inscrições","- **Tabela de Matrículas**: `matriculas` - contém as matrículas dos alunos","  - Status `ZERO` = Em andamento / Pendente","  - Status `ONE` = Em progresso","  - Status `TWO` = **APROVADO** (Certificado/Concluído) ✅","","## Arquivos Corrigidos","","### 1. `/app/api/lab/route.ts`","- ✅ Busca certificados de `matriculas` (status TWO)","- ✅ Inclui dados adicionais: `media`, `percentual_faltas`, `certificado_id`","- ✅ Contagem correta via `prisma.matriculas.count()`","","### 2. `/app/api/home/route.ts`","- ✅ Corrigido para usar `matriculas.count({ where: { status: 'TWO' } })`","","### 3. `/app/api/certificados/route.ts`","- ✅ Corrigido para buscar de `matriculas` com status TWO","- ✅ Inclui dados adicionais: `media`, `percentual_faltas`, `certificado_id`","","### 4. `/app/api/monitor/executivo/route.ts`","- ✅ Corrigido para usar `matriculas.count({ where: { status: 'TWO' } })`","","### 5. `/lib/bi/analysis.ts`","- ✅ Corrigido em múltiplas funções:","  - `analisarImpactoSocial()` - busca certificados Lab de `matriculas`","  - `analisarDesempenhoTerritorial()` - busca certificados Lab de `matriculas`","  - `analisarEficaciaProgramas()` - contagem de certificados Lab de `matriculas`","","### 6. `/lib/bi/lab-analysis.ts`","- ✅ Totalmente reescrito para usar `matriculas` (status TWO) em vez de `oxetechlab_inscricoes`","- ✅ Contagem por laboratório via `matriculas`","- ✅ Contagem por curso via `matriculas`","- ✅ Lista de alunos certificados via `matriculas`","","### 7. `/lib/audit/ai-auditor.ts`","- ✅ Auditoria corrigida para usar `matriculas` (status TWO)","- ✅ Verificações de inconsistências atualizadas","","## Impacto","","### Antes","- ❌ Certificados buscados de `oxetechlab_inscricoes` com status TWO","- ❌ Dados incompletos (sem média, faltas, etc.)","- ❌ Contagens incorretas","- ❌ Taxa de certificação incorreta","","### Agora","- ✅ Certificados buscados de `matriculas` com status TWO (APROVADO)","- ✅ Dados completos: média, percentual de faltas, certificado_id","- ✅ Contagens corretas","- ✅ Taxa de certificação precisa","","## Dados Adicionais Agora Disponíveis","","Para cada certificado Lab, agora temos acesso a:","- `media`: Média do aluno no curso","- `percentual_faltas`: Percentual de faltas","- `certificado_id`: ID do certificado gerado (se houver)","- `updated_at`: Data de conclusão/certificação","","## Verificação","","Para verificar se a correção está funcionando:","1. Acesse `/lab` - verifique o número de certificados","2. Acesse `/bi/lab` - verifique as métricas de certificação","3. Acesse `/certificados` - verifique a lista de alunos certificados do Lab","4. Acesse `/audit` - verifique se há alertas sobre certificados","","## Status","","✅ **Todas as queries corrigidas**","✅ **Código compilando sem erros**","✅ **Dados agora refletem a realidade do banco**",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000001,1000003,1000001,1000004,1000001,1000005,1000006,1000007,1000008,1000009,1000010,1000001,1000011,1000001,1000012,1000013,1000014,1000015,1000001,1000016,1000017,1000001,1000018,1000019,1000014,1000001,1000020,1000017,1000001,1000021,1000022,1000023,1000024,1000025,1000001,1000026,1000027,1000028,1000029,1000030,1000001,1000031,1000032,1000033,1000001,1000034,1000001,1000035,1000036,1000037,1000038,1000039,1000001,1000040,1000041,1000042,1000043,1000044,1000001,1000045,1000001,1000046,1000047,1000048,1000049,1000050,1000001,1000051,1000001,1000052,1000053,1000054,1000055,1000056,1000001,1000057,1000001,1000058,1000059,1000060,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}
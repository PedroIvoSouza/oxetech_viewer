{"fsPath":"\\home\\oxetech_mcz\\app\\api\\lab\\route.ts","fileUuid":"d639e870-b39f-4293-8331-afb5666f9252","fileSizeBytes":7226,"numLines":244,"diffChanges":[{"originalStartLineNumberOneIndexed":16,"originalEndLineNumberExclusiveOneIndexed":16,"modifiedStartLineNumberOneIndexed":16,"modifiedEndLineNumberExclusiveOneIndexed":23,"addedLines":["        alunos: {","          select: {","            id: true,","            name: true,","            email: true,","          },","        },"],"tokenizedAddedLines":[1000091,16,17,1000092,1000093,24,25]},{"originalStartLineNumberOneIndexed":20,"originalEndLineNumberExclusiveOneIndexed":20,"modifiedStartLineNumberOneIndexed":27,"modifiedEndLineNumberExclusiveOneIndexed":29,"addedLines":["            qtd_vagas_total: true,","            qtd_vagas_preenchidas: true,"],"tokenizedAddedLines":[1000094,1000095]},{"originalStartLineNumberOneIndexed":22,"originalEndLineNumberExclusiveOneIndexed":22,"modifiedStartLineNumberOneIndexed":31,"modifiedEndLineNumberExclusiveOneIndexed":32,"addedLines":["                id: true,"],"tokenizedAddedLines":[1000096]},{"originalStartLineNumberOneIndexed":23,"originalEndLineNumberExclusiveOneIndexed":23,"modifiedStartLineNumberOneIndexed":33,"modifiedEndLineNumberExclusiveOneIndexed":34,"addedLines":["                municipio: true,"],"tokenizedAddedLines":[1000097]},{"originalStartLineNumberOneIndexed":32,"originalEndLineNumberExclusiveOneIndexed":32,"modifiedStartLineNumberOneIndexed":43,"modifiedEndLineNumberExclusiveOneIndexed":67,"addedLines":["","    // Estatísticas gerais","    const [totalInscricoes, totalInscricoesPorStatus] = await Promise.all([","      prisma.oxetechlab_inscricoes.count(),","      prisma.oxetechlab_inscricoes.groupBy({","        by: ['status'],","        _count: true,","      }),","    ])","","    // Status específicos","    const inscricoesAtivas = await prisma.oxetechlab_inscricoes.count({","      where: {","        status: {","          not: 'FINALIZADO',","        },","      },","    })","","    const inscricoesFinalizadas = await prisma.oxetechlab_inscricoes.count({","      where: {","        status: 'FINALIZADO',","      },","    })"],"tokenizedAddedLines":[3,52,53,54,55,56,57,58,59,3,1000098,1000099,1000100,1000101,1000102,25,26,29,3,1000103,1000100,1000104,26,29]},{"originalStartLineNumberOneIndexed":40,"originalEndLineNumberExclusiveOneIndexed":42,"modifiedStartLineNumberOneIndexed":75,"modifiedEndLineNumberExclusiveOneIndexed":77,"addedLines":["    const distribuicaoPorCursoArray = Object.entries(distribuicaoPorCurso)","      .map(([curso, total]) => ({"],"tokenizedAddedLines":[1000105,1000106]},{"originalStartLineNumberOneIndexed":44,"originalEndLineNumberExclusiveOneIndexed":46,"modifiedStartLineNumberOneIndexed":79,"modifiedEndLineNumberExclusiveOneIndexed":81,"addedLines":["      }))","      .sort((a, b) => b.total - a.total)"],"tokenizedAddedLines":[1000107,1000108]},{"originalStartLineNumberOneIndexed":47,"originalEndLineNumberExclusiveOneIndexed":48,"modifiedStartLineNumberOneIndexed":82,"modifiedEndLineNumberExclusiveOneIndexed":83,"addedLines":["    // Evolução temporal mensal"],"tokenizedAddedLines":[1000109]},{"originalStartLineNumberOneIndexed":57,"originalEndLineNumberExclusiveOneIndexed":59,"modifiedStartLineNumberOneIndexed":92,"modifiedEndLineNumberExclusiveOneIndexed":100,"addedLines":["    const evolucaoTemporalArray = Object.entries(evolucaoTemporal)","      .sort((a, b) => {","        const dateA = new Date(a[0].split(' de ').reverse().join('-'))","        const dateB = new Date(b[0].split(' de ').reverse().join('-'))","        return dateA.getTime() - dateB.getTime()","      })","      .slice(-12)","      .map(([mes, total]) => ({"],"tokenizedAddedLines":[1000110,1000111,1000112,1000113,1000114,40,1000115,1000116]},{"originalStartLineNumberOneIndexed":61,"originalEndLineNumberExclusiveOneIndexed":72,"modifiedStartLineNumberOneIndexed":102,"modifiedEndLineNumberExclusiveOneIndexed":131,"addedLines":["      }))","","    // Evolução semanal (últimas 8 semanas)","    const oitoSemanasAtras = new Date()","    oitoSemanasAtras.setDate(oitoSemanasAtras.getDate() - 56)","","    const inscricoesRecentes = inscricoes.filter(","      (i) => new Date(i.created_at) >= oitoSemanasAtras","    )","","    const evolucaoSemanal = []","    for (let i = 7; i >= 0; i--) {","      const semana = new Date()","      semana.setDate(semana.getDate() - i * 7)","      const inicioSemana = new Date(semana)","      inicioSemana.setDate(inicioSemana.getDate() - inicioSemana.getDay())","      const fimSemana = new Date(inicioSemana)","      fimSemana.setDate(fimSemana.getDate() + 6)","","      const total = inscricoesRecentes.filter((insc) => {","        const data = new Date(insc.created_at)","        return data >= inicioSemana && data <= fimSemana","      }).length","","      evolucaoSemanal.push({","        semana: `Sem ${8 - i}`,","        inscricoes: total,","      })","    }"],"tokenizedAddedLines":[1000107,3,1000117,1000118,1000119,3,1000120,1000121,41,3,1000122,1000123,1000124,1000125,1000126,1000127,1000128,1000129,3,1000130,1000131,1000132,1000133,3,1000134,1000135,51,40,1000136]},{"originalStartLineNumberOneIndexed":74,"originalEndLineNumberExclusiveOneIndexed":102,"modifiedStartLineNumberOneIndexed":133,"modifiedEndLineNumberExclusiveOneIndexed":211,"addedLines":["    const laboratoriosMap = new Map<","      string,","      {","        nome: string","        municipio: string","        totalInscricoes: number","        cursos: Set<string>","        vagasOcupadas: number","        vagasTotal: number","      }","    >()","","    inscricoes.forEach((inscricao) => {","      const labNome = inscricao.turmas?.laboratorios?.nome || 'Sem laboratório'","      const municipio =","        inscricao.turmas?.laboratorios?.municipio || 'Sem município'","      const curso = inscricao.turmas?.titulo || 'Sem curso'","","      if (!laboratoriosMap.has(labNome)) {","        laboratoriosMap.set(labNome, {","          nome: labNome,","          municipio,","          totalInscricoes: 0,","          cursos: new Set(),","          vagasOcupadas: 0,","          vagasTotal: 0,","        })","      }","","      const lab = laboratoriosMap.get(labNome)!","      lab.totalInscricoes++","      lab.cursos.add(curso)","      lab.vagasOcupadas += inscricao.turmas?.qtd_vagas_preenchidas || 0","      lab.vagasTotal += inscricao.turmas?.qtd_vagas_total || 0","    })","","    const inscricoesPorLaboratorioArray = Array.from(laboratoriosMap.values())","      .map((lab) => ({","        laboratorio: lab.nome,","        municipio: lab.municipio,","        totalInscricoes: lab.totalInscricoes,","        totalCursos: lab.cursos.size,","        vagasOcupadas: lab.vagasOcupadas,","        vagasTotal: lab.vagasTotal,","        vagasLivres: lab.vagasTotal - lab.vagasOcupadas,","      }))","      .sort((a, b) => b.totalInscricoes - a.totalInscricoes)","","    // Média por laboratório","    const mediaPorLaboratorio =","      inscricoesPorLaboratorioArray.length > 0","        ? inscricoesPorLaboratorioArray.reduce(","            (acc, lab) => acc + lab.totalInscricoes,","            0","          ) / inscricoesPorLaboratorioArray.length","        : 0","","    // Slots ocupados vs livres","    const totalVagasOcupadas = inscricoesPorLaboratorioArray.reduce(","      (acc, lab) => acc + lab.vagasOcupadas,","      0","    )","    const totalVagasLivres = inscricoesPorLaboratorioArray.reduce(","      (acc, lab) => acc + lab.vagasLivres,","      0","    )","    const totalVagas = totalVagasOcupadas + totalVagasLivres","","    // Lista detalhada de inscrições","    const inscricoesDetalhadas = inscricoes.slice(0, 100).map((insc) => ({","      id: insc.id,","      aluno: insc.alunos?.name || 'Sem nome',","      email: insc.alunos?.email || 'Sem email',","      curso: insc.turmas?.titulo || 'Sem curso',","      laboratorio: insc.turmas?.laboratorios?.nome || 'Sem laboratório',","      municipio: insc.turmas?.laboratorios?.municipio || 'Sem município',","      status: insc.status,","      dataInscricao: insc.created_at,"],"tokenizedAddedLines":[1000137,1000138,1000139,1000140,1000141,1000142,1000143,1000144,1000145,1000146,1000147,3,1000148,1000149,1000150,1000151,32,3,1000152,1000153,1000154,1000155,1000156,1000157,1000158,1000159,1000160,1000146,3,1000161,1000162,1000163,1000164,1000165,29,3,1000166,1000167,1000168,1000169,1000170,1000171,1000172,1000173,1000174,1000107,1000175,3,1000176,1000177,1000178,1000179,1000180,1000181,1000182,1000183,3,1000184,1000185,1000186,1000187,41,1000188,1000189,1000187,41,1000190,3,1000191,1000192,1000193,1000194,1000195,1000196,1000197,1000198,1000199,1000200]},{"originalStartLineNumberOneIndexed":105,"originalEndLineNumberExclusiveOneIndexed":105,"modifiedStartLineNumberOneIndexed":214,"modifiedEndLineNumberExclusiveOneIndexed":215,"addedLines":["      data: {"],"tokenizedAddedLines":[1000201]},{"originalStartLineNumberOneIndexed":107,"originalEndLineNumberExclusiveOneIndexed":107,"modifiedStartLineNumberOneIndexed":217,"modifiedEndLineNumberExclusiveOneIndexed":219,"addedLines":["          inscricoesAtivas,","          inscricoesFinalizadas,"],"tokenizedAddedLines":[1000202,1000203]},{"originalStartLineNumberOneIndexed":111,"originalEndLineNumberExclusiveOneIndexed":111,"modifiedStartLineNumberOneIndexed":223,"modifiedEndLineNumberExclusiveOneIndexed":227,"addedLines":["          mediaPorLaboratorio: Math.round(mediaPorLaboratorio),","          totalVagas,","          vagasOcupadas: totalVagasOcupadas,","          vagasLivres: totalVagasLivres,"],"tokenizedAddedLines":[1000204,1000205,1000206,1000207]},{"originalStartLineNumberOneIndexed":114,"originalEndLineNumberExclusiveOneIndexed":114,"modifiedStartLineNumberOneIndexed":230,"modifiedEndLineNumberExclusiveOneIndexed":231,"addedLines":["        evolucaoSemanal: evolucaoSemanal,"],"tokenizedAddedLines":[1000208]},{"originalStartLineNumberOneIndexed":115,"originalEndLineNumberExclusiveOneIndexed":115,"modifiedStartLineNumberOneIndexed":232,"modifiedEndLineNumberExclusiveOneIndexed":235,"addedLines":["        inscricoes: inscricoesDetalhadas,","      },","      error: null,"],"tokenizedAddedLines":[1000209,26,1000210]},{"originalStartLineNumberOneIndexed":119,"originalEndLineNumberExclusiveOneIndexed":120,"modifiedStartLineNumberOneIndexed":239,"modifiedEndLineNumberExclusiveOneIndexed":240,"addedLines":["      { data: null, error: 'Failed to fetch lab data' },"],"tokenizedAddedLines":[1000211]},{"originalStartLineNumberOneIndexed":124,"originalEndLineNumberExclusiveOneIndexed":125,"modifiedStartLineNumberOneIndexed":244,"modifiedEndLineNumberExclusiveOneIndexed":244}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}
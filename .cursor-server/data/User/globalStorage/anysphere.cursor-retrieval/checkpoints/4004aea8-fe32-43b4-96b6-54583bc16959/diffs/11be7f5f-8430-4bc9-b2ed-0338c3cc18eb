{"fsPath":"\\home\\oxetech_mcz\\app\\api\\alunos\\route.ts","fileUuid":"11be7f5f-8430-4bc9-b2ed-0338c3cc18eb","fileSizeBytes":5912,"numLines":214,"diffChanges":[{"originalStartLineNumberOneIndexed":12,"originalEndLineNumberExclusiveOneIndexed":12,"modifiedStartLineNumberOneIndexed":12,"modifiedEndLineNumberExclusiveOneIndexed":49,"addedLines":["","    // Filtros avançados","    const programa = searchParams.get('programa') || 'all'","    const status = searchParams.get('status') || 'all'","    const municipio = searchParams.get('municipio') || ''","    const busca = searchParams.get('busca') || ''","","    // Construir where clause","    const where: any = {}","","    if (busca) {","      where.OR = [","        { name: { contains: busca, mode: 'insensitive' as any } },","        { email: { contains: busca, mode: 'insensitive' as any } },","      ]","    }","","    if (status !== 'all') {","      where.status = status","    }","","    if (municipio) {","      where.municipio = { contains: municipio, mode: 'insensitive' as any }","    }","","    // Filtro por programa","    if (programa !== 'all') {","      if (programa === 'work') {","        where.oxetechwork_inscricao_alunos = { some: {} }","      } else if (programa === 'edu') {","        where.matriculas_oxetech_edu = { some: {} }","      } else if (programa === 'trilhas') {","        where.inscricoes_trilhas_alunos = { some: {} }","      } else if (programa === 'lab') {","        where.oxetechlab_inscricoes = { some: {} }","      }","    }"],"tokenizedAddedLines":[3,1000082,1000083,1000084,1000085,1000086,3,1000087,1000088,3,1000089,1000090,1000091,1000092,1000093,1000094,3,1000095,1000096,1000094,3,1000097,1000098,1000094,3,1000099,1000100,1000101,1000102,1000103,1000104,1000105,1000106,1000107,1000108,1000109,1000094]},{"originalStartLineNumberOneIndexed":16,"originalEndLineNumberExclusiveOneIndexed":16,"modifiedStartLineNumberOneIndexed":53,"modifiedEndLineNumberExclusiveOneIndexed":54,"addedLines":["        where,"],"tokenizedAddedLines":[1000110]},{"originalStartLineNumberOneIndexed":22,"originalEndLineNumberExclusiveOneIndexed":22,"modifiedStartLineNumberOneIndexed":60,"modifiedEndLineNumberExclusiveOneIndexed":61,"addedLines":["          municipio: true,"],"tokenizedAddedLines":[1000111]},{"originalStartLineNumberOneIndexed":23,"originalEndLineNumberExclusiveOneIndexed":23,"modifiedStartLineNumberOneIndexed":62,"modifiedEndLineNumberExclusiveOneIndexed":63,"addedLines":["          avatar_url: true,"],"tokenizedAddedLines":[1000112]},{"originalStartLineNumberOneIndexed":34,"originalEndLineNumberExclusiveOneIndexed":34,"modifiedStartLineNumberOneIndexed":74,"modifiedEndLineNumberExclusiveOneIndexed":80,"addedLines":["          oxetechwork_inscricao_alunos: {","            select: {","              id: true,","              status: true,","            },","          },"],"tokenizedAddedLines":[1000113,22,23,33,30,31]},{"originalStartLineNumberOneIndexed":71,"originalEndLineNumberExclusiveOneIndexed":71,"modifiedStartLineNumberOneIndexed":117,"modifiedEndLineNumberExclusiveOneIndexed":118,"addedLines":["              created_at: true,"],"tokenizedAddedLines":[1000114]},{"originalStartLineNumberOneIndexed":77,"originalEndLineNumberExclusiveOneIndexed":77,"modifiedStartLineNumberOneIndexed":124,"modifiedEndLineNumberExclusiveOneIndexed":128,"addedLines":["            orderBy: {","              created_at: 'desc',","            },","            take: 1,"],"tokenizedAddedLines":[1000115,1000116,30,1000117]},{"originalStartLineNumberOneIndexed":85,"originalEndLineNumberExclusiveOneIndexed":86,"modifiedStartLineNumberOneIndexed":136,"modifiedEndLineNumberExclusiveOneIndexed":137,"addedLines":["      prisma.alunos.count({ where }),"],"tokenizedAddedLines":[1000118]},{"originalStartLineNumberOneIndexed":89,"originalEndLineNumberExclusiveOneIndexed":90,"modifiedStartLineNumberOneIndexed":140,"modifiedEndLineNumberExclusiveOneIndexed":154,"addedLines":["    const alunosData = alunos.map((aluno) => {","      // Calcular progresso geral em trilhas","      const trilhasTotal = aluno.inscricoes_trilhas_alunos.length","      const trilhasConcluidas = aluno.inscricoes_trilhas_alunos.filter(","        (i) => i.concluido","      ).length","      const progressoGeral =","        trilhasTotal > 0 ? (trilhasConcluidas / trilhasTotal) * 100 : 0","","      // Última atividade","      const ultimaFrequencia = aluno.frequencias[0]","      const ultimaAtividade = ultimaFrequencia?.created_at || aluno.created_at","","      return {"],"tokenizedAddedLines":[1000119,1000120,1000121,1000122,59,1000123,1000124,1000125,3,1000126,1000127,1000128,3,1000129]},{"originalStartLineNumberOneIndexed":94,"originalEndLineNumberExclusiveOneIndexed":94,"modifiedStartLineNumberOneIndexed":158,"modifiedEndLineNumberExclusiveOneIndexed":159,"addedLines":["        municipio: aluno.municipio,"],"tokenizedAddedLines":[1000130]},{"originalStartLineNumberOneIndexed":95,"originalEndLineNumberExclusiveOneIndexed":95,"modifiedStartLineNumberOneIndexed":160,"modifiedEndLineNumberExclusiveOneIndexed":161,"addedLines":["        avatar_url: aluno.avatar_url,"],"tokenizedAddedLines":[1000131]},{"originalStartLineNumberOneIndexed":96,"originalEndLineNumberExclusiveOneIndexed":100,"modifiedStartLineNumberOneIndexed":162,"modifiedEndLineNumberExclusiveOneIndexed":165,"addedLines":["        trilhasInscritas: trilhasTotal,","        trilhasConcluidas,","        progressoGeral,"],"tokenizedAddedLines":[1000132,1000133,1000134]},{"originalStartLineNumberOneIndexed":103,"originalEndLineNumberExclusiveOneIndexed":103,"modifiedStartLineNumberOneIndexed":168,"modifiedEndLineNumberExclusiveOneIndexed":169,"addedLines":["        workInscricoes: aluno.oxetechwork_inscricao_alunos.length,"],"tokenizedAddedLines":[1000135]},{"originalStartLineNumberOneIndexed":104,"originalEndLineNumberExclusiveOneIndexed":105,"modifiedStartLineNumberOneIndexed":170,"modifiedEndLineNumberExclusiveOneIndexed":190,"addedLines":["        ultimaAtividade,","        programas: [","          aluno.oxetechwork_inscricao_alunos.length > 0 ? 'Work' : null,","          aluno.matriculas_oxetech_edu.length > 0 ? 'Edu' : null,","          aluno.inscricoes_trilhas_alunos.length > 0 ? 'Trilhas' : null,","          aluno.oxetechlab_inscricoes.length > 0 ? 'Lab' : null,","        ].filter((p) => p !== null) as string[],","      }","    })","","    // Obter lista de municípios únicos","    const municipios = await prisma.alunos.findMany({","      select: {","        municipio: true,","      },","      distinct: ['municipio'],","      orderBy: {","        municipio: 'asc',","      },","    })"],"tokenizedAddedLines":[1000136,1000137,1000138,1000139,1000140,1000141,1000142,1000109,74,3,1000143,1000144,1000145,1000146,73,1000147,1000148,1000149,73,74]},{"originalStartLineNumberOneIndexed":107,"originalEndLineNumberExclusiveOneIndexed":107,"modifiedStartLineNumberOneIndexed":192,"modifiedEndLineNumberExclusiveOneIndexed":193,"addedLines":["      data: {"],"tokenizedAddedLines":[1000150]},{"originalStartLineNumberOneIndexed":114,"originalEndLineNumberExclusiveOneIndexed":114,"modifiedStartLineNumberOneIndexed":200,"modifiedEndLineNumberExclusiveOneIndexed":205,"addedLines":["        filters: {","          municipios: municipios.map((m) => m.municipio),","        },","      },","      error: null,"],"tokenizedAddedLines":[1000151,1000152,41,73,1000153]},{"originalStartLineNumberOneIndexed":118,"originalEndLineNumberExclusiveOneIndexed":119,"modifiedStartLineNumberOneIndexed":209,"modifiedEndLineNumberExclusiveOneIndexed":210,"addedLines":["      { data: null, error: 'Failed to fetch alunos data' },"],"tokenizedAddedLines":[1000154]},{"originalStartLineNumberOneIndexed":123,"originalEndLineNumberExclusiveOneIndexed":124,"modifiedStartLineNumberOneIndexed":214,"modifiedEndLineNumberExclusiveOneIndexed":214}],"gitInfo":{"noRepoFound":true},"kind":"KIND_MODIFIED"}
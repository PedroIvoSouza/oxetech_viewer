{"fsPath":"\\home\\oxetech_mcz\\docs\\CORRECAO_UNAUTHORIZED.md","fileUuid":"a9e64a19-4192-4ad7-a33f-4cc8ab53b04b","fileSizeBytes":2783,"numLines":96,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":97,"addedLines":["# Corre√ß√£o do Erro Unauthorized","","## ‚úÖ Problemas Identificados e Corrigidos","","### 1. **Fluxo de Login Melhorado**","   - ‚úÖ Verifica√ß√£o se cookie foi setado antes de redirecionar","   - ‚úÖ Aguarda 200ms para garantir processamento do cookie","   - ‚úÖ Mensagem de erro espec√≠fica se cookie n√£o foi configurado","","### 2. **Tratamento de Erros Melhorado**","   - ‚úÖ Mensagens de erro mais espec√≠ficas","   - ‚úÖ Detec√ß√£o de erro 401 (Unauthorized)","   - ‚úÖ Link para login em caso de erro de autentica√ß√£o","   - ‚úÖ Logs detalhados no middleware","","### 3. **Middleware com Logs**","   - ‚úÖ Log de erros de JWT","   - ‚úÖ Mensagens de erro mais descritivas","","## üîß Corre√ß√µes Aplicadas","","### Login (`app/login/page.tsx`)","- ‚úÖ Verifica√ß√£o de cookie ap√≥s login","- ‚úÖ Delay para garantir que cookie seja processado","- ‚úÖ Mensagem de erro espec√≠fica se cookie n√£o for setado","","### P√°ginas BI (`app/(dashboard)/bi/page.tsx` e `app/(dashboard)/bi/lab/page.tsx`)","- ‚úÖ Detec√ß√£o de erro 401","- ‚úÖ Mensagem espec√≠fica para erro de autentica√ß√£o","- ‚úÖ Link direto para p√°gina de login","","### Middleware (`middleware.ts`)","- ‚úÖ Logs detalhados de erros de JWT","- ‚úÖ Mensagens de erro mais descritivas","","## üìã Como Resolver o Erro","","### Se estiver recebendo 401 Unauthorized:","","1. **Verificar se est√° logado:**","   - Abra DevTools ‚Üí Application ‚Üí Cookies","   - Deve existir cookie `oxetech-auth-token`","   - Se n√£o existir, fa√ßa login novamente","","2. **Fazer Login:**","   - Acesse `/login`","   - Use credenciais:","     - Admin: `admin@oxetech.al.gov.br` / `admin123`","     - Gestor: `gestor@oxetech.al.gov.br` / `gestor123`","     - Visualiza√ß√£o: `visualizacao@oxetech.al.gov.br` / `view123`","","3. **Verificar Token:**","   - Se o cookie existe mas ainda d√° erro, o token pode estar expirado","   - Fa√ßa logout e login novamente","   - O token expira em 8 horas","","4. **Limpar Cache:**","   - Limpe cookies do navegador","   - Fa√ßa login novamente","","## üîç Debug","","### Verificar Cookie no Console:","```javascript","// No console do navegador","document.cookie.split(';').find(c => c.includes('oxetech-auth-token'))","```","","### Verificar Requisi√ß√µes:","- DevTools ‚Üí Network","- Filtrar por `/api/bi/lab-detalhado`","- Verificar Headers ‚Üí Request Headers ‚Üí Cookie","- Verificar Response ‚Üí Status (deve ser 200, n√£o 401)","","### Verificar Logs do Servidor:","- Terminal onde `npm run dev` est√° rodando","- Procurar por logs do middleware","- Verificar erros de JWT","","## ‚úÖ Status","","- ‚úÖ Login corrigido com verifica√ß√£o de cookie","- ‚úÖ Tratamento de erros melhorado nas p√°ginas","- ‚úÖ Mensagens de erro mais claras","- ‚úÖ Link para login em caso de erro 401","- ‚úÖ Logs detalhados no middleware","","---","","**Nota**: Se o erro persistir ap√≥s fazer login, verifique:","1. Cookie est√° sendo setado corretamente","2. Cookie est√° sendo enviado nas requisi√ß√µes","3. Token JWT est√° v√°lido (n√£o expirado)","4. JWT_SECRET est√° configurado corretamente","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000001,1000003,1000004,1000005,1000006,1000001,1000007,1000008,1000009,1000010,1000011,1000001,1000012,1000013,1000014,1000001,1000015,1000001,1000016,1000017,1000018,1000019,1000001,1000020,1000021,1000022,1000023,1000001,1000024,1000025,1000026,1000001,1000027,1000001,1000028,1000001,1000029,1000030,1000031,1000032,1000001,1000033,1000034,1000035,1000036,1000037,1000038,1000001,1000039,1000040,1000041,1000042,1000001,1000043,1000044,1000045,1000001,1000046,1000001,1000047,1000048,1000049,1000050,1000051,1000001,1000052,1000053,1000054,1000055,1000056,1000001,1000057,1000058,1000059,1000060,1000001,1000061,1000001,1000062,1000063,1000064,1000065,1000066,1000001,1000067,1000001,1000068,1000069,1000070,1000071,1000072,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}
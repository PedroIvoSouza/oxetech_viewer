{"fsPath":"\\home\\oxetech_mcz\\docs\\COMPATIBILIZACAO_CSV_LAB.md","fileUuid":"29af3545-65d9-4019-b4d9-4c62d3f0ba04","fileSizeBytes":5309,"numLines":188,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":189,"addedLines":["# Compatibiliza√ß√£o de Dados Legados do Lab (CSV)","","## Objetivo","","Integrar os dados hist√≥ricos do CSV (`Dashboard - OxeTech lab - Respostas ao formul√°rio 1.csv`) com o banco de dados atual, evitando duplica√ß√µes e garantindo a preval√™ncia dos dados mais completos.","","## Estrat√©gia","","### 1. Normaliza√ß√£o","- **Laborat√≥rios**: Normaliza√ß√£o de nomes (ex: \"macei√≥ - centro de inova√ß√£o\" ‚Üí \"Macei√≥ - Centro de Inova√ß√£o\")","- **Cursos**: Uso da fun√ß√£o `normalizarCurso()` para padronizar nomes","- **Datas**: Convers√£o de formato brasileiro (DD/MM/YYYY) para Date","","### 2. Compara√ß√£o de Turmas","Duas turmas s√£o consideradas similares se:","- Mesmo laborat√≥rio (normalizado)","- Mesmo curso (normalizado)","- Datas de in√≠cio e encerramento com diferen√ßa ‚â§ 30 dias","","### 3. Preval√™ncia","Em caso de turmas duplicadas:","- **Prevalece a turma com maior n√∫mero de formados (certificados)**","- Se CSV tem mais formados ‚Üí Atualiza banco","- Se Banco tem mais formados ‚Üí Mant√©m banco","","### 4. Importa√ß√£o","- **Turmas novas**: Criadas no banco","- **Laborat√≥rios inexistentes**: Criados automaticamente","- **Matr√≠culas**: N√£o podem ser criadas automaticamente sem dados dos alunos individuais","","## Scripts Dispon√≠veis","","### 1. Compatibiliza√ß√£o (An√°lise)","```bash","npm run csv:compatibilizar","```","","Este script:","- Processa o CSV","- Busca turmas no banco","- Compara e identifica duplicatas","- Gera relat√≥rio com:","  - Total de turmas no CSV","  - Total de turmas no banco","  - Duplicatas encontradas","  - Turmas para importar","  - Turmas para atualizar","  - Detalhes de preval√™ncia","","**N√£o faz altera√ß√µes no banco de dados.**","","### 2. Importa√ß√£o (Dry-Run)","```bash","npm run csv:importar:dry-run","```","","Este script:","- Executa a compatibiliza√ß√£o","- Simula a importa√ß√£o/atualiza√ß√£o","- Mostra o que seria feito","- **N√£o faz altera√ß√µes no banco de dados**","","### 3. Importa√ß√£o (Real)","```bash","npm run csv:importar","```","","Este script:","- Executa a compatibiliza√ß√£o","- Importa novas turmas","- Atualiza turmas existentes (se CSV prevalece)","- Cria laborat√≥rios se necess√°rio","- **Faz altera√ß√µes no banco de dados**","","## Estrutura dos Scripts","","### `/scripts/compatibilizar-csv-lab.ts`","- Fun√ß√£o `processarCSV()`: L√™ e normaliza dados do CSV","- Fun√ß√£o `buscarTurmasBanco()`: Busca turmas existentes no banco","- Fun√ß√£o `compatibilizarDados()`: Compara e identifica diferen√ßas","","### `/scripts/importar-csv-lab.ts`","- Fun√ß√£o `encontrarOuCriarLaboratorio()`: Encontra ou cria laborat√≥rio","- Fun√ß√£o `encontrarOuCriarTurma()`: Encontra ou cria turma","- Fun√ß√£o `importarDados()`: Executa a importa√ß√£o completa","","## Limita√ß√µes","","### ‚ö†Ô∏è Matr√≠culas Individuais","O CSV cont√©m apenas **n√∫meros agregados** (total de inscritos, total de formados). N√£o cont√©m dados dos alunos individuais.","","**Consequ√™ncia**: N√£o √© poss√≠vel criar matr√≠culas automaticamente sem:","- Um CSV adicional com dados dos alunos","- Ou integra√ß√£o manual com dados existentes","","### ‚ö†Ô∏è Dados de Turmas","O CSV n√£o cont√©m todos os campos necess√°rios para criar uma turma completa:","- `carga_horaria`: Usa valor padr√£o (40h)","- `qtd_aulas`: Usa valor padr√£o (10 aulas)","- `perguntas`: Array vazio","","**Recomenda√ß√£o**: Revisar e ajustar manualmente ap√≥s importa√ß√£o.","","### ‚ö†Ô∏è Datas Inv√°lidas","Algumas datas no CSV podem estar incorretas (ex: `03/04/1901`). O script:","- Detecta e avisa sobre datas inv√°lidas","- Usa data atual como fallback","","## Fluxo de Uso Recomendado","","1. **An√°lise Inicial**","   ```bash","   npm run csv:compatibilizar","   ```","   - Revisar o relat√≥rio","   - Verificar duplicatas e preval√™ncias","","2. **Simula√ß√£o**","   ```bash","   npm run csv:importar:dry-run","   ```","   - Verificar o que seria feito","   - Validar decis√µes de preval√™ncia","","3. **Backup do Banco** (Obrigat√≥rio!)","   ```bash","   # Fazer backup antes de importar","   pg_dump -U user -d database > backup_$(date +%Y%m%d).sql","   ```","","4. **Importa√ß√£o Real**","   ```bash","   npm run csv:importar","   ```","   - Executar importa√ß√£o","   - Revisar logs de cria√ß√£o/atualiza√ß√£o","","5. **Valida√ß√£o**","   - Verificar turmas criadas no banco","   - Revisar n√∫meros de formados","   - Ajustar manualmente se necess√°rio","","## Exemplo de Sa√≠da","","```","üîÑ Iniciando compatibiliza√ß√£o de dados legados...","","üìÑ Processando CSV...","‚úÖ 635 turmas encontradas no CSV","","üîç Buscando turmas no banco de dados...","‚úÖ 142 turmas encontradas no banco","","üîç Comparando turmas...","","‚ö†Ô∏è  Duplicata encontrada: Macei√≥ - Centro de Inova√ß√£o - L√≥gica de Programa√ß√£o","   CSV: 18 formados | Banco: 12 formados","   ‚Üí CSV prevalece (mais formados)","","üìä Resumo:","   - Turmas no CSV: 635","   - Turmas no banco: 142","   - Duplicatas encontradas: 45","   - Turmas para importar: 590","   - Turmas para atualizar: 12","```","","## Notas Importantes","","1. **Sem Dados de Alunos**: O CSV n√£o cont√©m dados individuais dos alunos, ent√£o as matr√≠culas n√£o podem ser criadas automaticamente.","","2. **Turmas Duplicadas**: A l√≥gica de preval√™ncia √© autom√°tica, mas pode ser ajustada manualmente se necess√°rio.","","3. **Normaliza√ß√£o de Cursos**: Usa a mesma l√≥gica do sistema (`normalizarCurso()`), garantindo consist√™ncia.","","4. **Toler√¢ncia de Datas**: 30 dias de diferen√ßa √© considerado \"mesma turma\". Ajuste se necess√°rio.","","5. **Cria√ß√£o de Laborat√≥rios**: Laborat√≥rios inexistentes s√£o criados automaticamente com coordenador padr√£o (primeiro aluno).","","## Suporte","","Em caso de problemas:","1. Verificar logs do script","2. Revisar formato do CSV","3. Validar dados no banco","4. Executar em modo dry-run antes de importar","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000001,1000003,1000001,1000004,1000001,1000005,1000006,1000007,1000008,1000001,1000009,1000010,1000011,1000012,1000013,1000001,1000014,1000015,1000016,1000017,1000018,1000001,1000019,1000020,1000021,1000022,1000001,1000023,1000001,1000024,1000025,1000026,1000027,1000001,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000036,1000037,1000038,1000001,1000039,1000001,1000040,1000025,1000041,1000027,1000001,1000028,1000042,1000043,1000044,1000045,1000001,1000046,1000025,1000047,1000027,1000001,1000028,1000042,1000048,1000049,1000050,1000051,1000001,1000052,1000001,1000053,1000054,1000055,1000056,1000001,1000057,1000058,1000059,1000060,1000001,1000061,1000001,1000062,1000063,1000001,1000064,1000065,1000066,1000001,1000067,1000068,1000069,1000070,1000071,1000001,1000072,1000001,1000073,1000074,1000075,1000076,1000001,1000077,1000001,1000078,1000079,1000080,1000081,1000082,1000083,1000001,1000084,1000079,1000085,1000081,1000086,1000087,1000001,1000088,1000079,1000089,1000090,1000081,1000001,1000091,1000079,1000092,1000081,1000093,1000094,1000001,1000095,1000096,1000097,1000098,1000001,1000099,1000001,1000027,1000100,1000001,1000101,1000102,1000001,1000103,1000104,1000001,1000105,1000001,1000106,1000107,1000108,1000001,1000109,1000110,1000111,1000112,1000113,1000114,1000027,1000001,1000115,1000001,1000116,1000001,1000117,1000001,1000118,1000001,1000119,1000001,1000120,1000001,1000121,1000001,1000122,1000123,1000124,1000125,1000126,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}
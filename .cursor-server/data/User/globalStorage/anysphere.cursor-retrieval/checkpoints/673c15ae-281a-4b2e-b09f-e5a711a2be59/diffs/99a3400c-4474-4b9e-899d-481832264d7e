{"fsPath":"\\home\\oxetech_mcz\\docs\\CONFIGURACAO_ACESSO_EXTERNO.md","fileUuid":"99a3400c-4474-4b9e-899d-481832264d7e","fileSizeBytes":5315,"numLines":240,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":241,"addedLines":["# Configuração de Acesso Externo - Google Cloud","","## IP Público da Instância","","**IP Público:** `35.226.67.209`","","**Link de Acesso:** `http://35.226.67.209:3000`","","## Configuração do Next.js","","O Next.js já está configurado para aceitar conexões externas:","","- **Desenvolvimento:** `npm run dev` - Escuta em `0.0.0.0:3000`","- **Produção:** `npm run start` - Escuta em `0.0.0.0:3000`","","### Scripts Disponíveis","","```bash","# Desenvolvimento (acesso externo)","npm run dev","","# Desenvolvimento (apenas localhost)","npm run dev:local","","# Produção (acesso externo)","npm run build","npm run start","","# Produção (apenas localhost)","npm run build","npm run start:local","```","","## Configuração do Firewall do Google Cloud","","Para permitir acesso externo, você precisa configurar uma regra de firewall no Google Cloud:","","### Via Console do Google Cloud","","1. Acesse o [Console do Google Cloud](https://console.cloud.google.com/)","2. Navegue até **VPC Network** > **Firewall**","3. Clique em **Create Firewall Rule**","4. Configure:","   - **Name:** `allow-nextjs-port-3000`","   - **Direction:** Ingress","   - **Action on match:** Allow","   - **Targets:** All instances in the network (ou selecione sua instância)","   - **Source IP ranges:** `0.0.0.0/0` (todos) ou IPs específicos","   - **Protocols and ports:** ","     - ✅ TCP","     - Port: `3000`","","### Via gcloud CLI","","**1. Autenticar (se necessário):**","```bash","gcloud auth login","gcloud config set project SEU_PROJECT_ID","```","","**2. Criar regra de firewall:**","```bash","gcloud compute firewall-rules create allow-nextjs-port-3000 \\","  --allow tcp:3000 \\","  --source-ranges 0.0.0.0/0 \\","  --description \"Allow external access to Next.js on port 3000\"","```","","**3. Ou usar o script automático:**","```bash","bash scripts/configurar-firewall-gcp.sh","```","","### Via Terraform (opcional)","","```hcl","resource \"google_compute_firewall\" \"allow_nextjs\" {","  name    = \"allow-nextjs-port-3000\"","  network = \"default\"","","  allow {","    protocol = \"tcp\"","    ports    = [\"3000\"]","  }","","  source_ranges = [\"0.0.0.0/0\"]","  description   = \"Allow external access to Next.js on port 3000\"","}","```","","## Verificar Configuração","","### 1. Verificar se o Next.js está escutando em todas as interfaces","","```bash","netstat -tlnp | grep 3000","# Deve mostrar: :::3000 (todas as interfaces) ou 0.0.0.0:3000","```","","### 2. Testar acesso local","","```bash","curl http://localhost:3000","curl http://10.128.0.2:3000","```","","### 3. Testar acesso externo","","```bash","curl http://35.226.67.209:3000","```","","## Segurança","","### Recomendações","","1. **Use HTTPS em produção:**","   - Configure um Load Balancer ou Reverse Proxy (nginx/Apache)","   - Use certificado SSL/TLS (Let's Encrypt)","","2. **Restrinja IPs de origem (opcional):**","   - Em vez de `0.0.0.0/0`, use IPs específicos no firewall","   - Exemplo: `--source-ranges 123.456.789.0/24`","","3. **Configure autenticação:**","   - O sistema já tem middleware de autenticação","   - Certifique-se de que está funcionando corretamente","","4. **Use variáveis de ambiente:**","   - Não exponha credenciais no código","   - Use `.env` para configurações sensíveis","","## Nginx Reverse Proxy (Recomendado para Produção)","","Para produção, é recomendado usar Nginx como reverse proxy:","","```nginx","server {","    listen 80;","    server_name seu-dominio.com;","","    location / {","        proxy_pass http://localhost:3000;","        proxy_http_version 1.1;","        proxy_set_header Upgrade $http_upgrade;","        proxy_set_header Connection 'upgrade';","        proxy_set_header Host $host;","        proxy_cache_bypass $http_upgrade;","    }","}","```","","## Troubleshooting","","### Problema: Não consigo acessar externamente","","**Soluções:**","","1. Verifique se o firewall está configurado:","```bash","gcloud compute firewall-rules list | grep 3000","```","","2. Verifique se a instância tem IP público:","```bash","gcloud compute instances describe NOME_DA_INSTANCIA --zone ZONA | grep natIP","```","","3. Verifique se o Next.js está rodando:","```bash","ps aux | grep next","```","","4. Verifique se está escutando na porta correta:","```bash","netstat -tlnp | grep 3000","```","","5. Teste a conectividade:","```bash","# Da sua máquina local","telnet 35.226.67.209 3000","# ou","nc -zv 35.226.67.209 3000","```","","### Problema: Conexão recusada","","- Verifique se o Next.js está escutando em `0.0.0.0` e não apenas `127.0.0.1`","- Verifique se há outro firewall (iptables, ufw) bloqueando","","### Problema: Timeout","","- Verifique as regras de firewall do Google Cloud","- Verifique se a instância está rodando","- Verifique os logs do Next.js","","## Logs","","Para monitorar acessos:","","```bash","# Logs do Next.js","npm run dev 2>&1 | tee nextjs.log","","# Logs do sistema (se usando PM2)","pm2 logs nextjs","```","","## Porta Alternativa","","Se quiser usar outra porta (ex: 8080):","","1. Modifique o `package.json`:","```json","\"dev\": \"next dev -H 0.0.0.0 -p 8080\"","```","","2. Configure o firewall para a nova porta:","```bash","gcloud compute firewall-rules create allow-nextjs-port-8080 \\","  --allow tcp:8080 \\","  --source-ranges 0.0.0.0/0","```","","## Status Atual","","✅ Next.js configurado para aceitar conexões externas  ","✅ Scripts atualizados (`npm run dev` e `npm run start`)  ","⚠️ **Pendente:** Configurar regra de firewall no Google Cloud  ","⚠️ **Recomendado:** Configurar HTTPS/SSL para produção  ","","## Próximos Passos","","1. Configurar regra de firewall no Google Cloud (ver instruções acima)","2. Testar acesso externo: `http://35.226.67.209:3000`","3. Configurar HTTPS (Load Balancer ou Nginx + Let's Encrypt)","4. Configurar domínio (opcional)","",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000001,1000003,1000001,1000004,1000001,1000005,1000001,1000006,1000001,1000007,1000008,1000001,1000009,1000001,1000010,1000011,1000012,1000001,1000013,1000014,1000001,1000015,1000016,1000017,1000001,1000018,1000016,1000019,1000020,1000001,1000021,1000001,1000022,1000001,1000023,1000001,1000024,1000025,1000026,1000027,1000028,1000029,1000030,1000031,1000032,1000033,1000034,1000035,1000001,1000036,1000001,1000037,1000010,1000038,1000039,1000020,1000001,1000040,1000010,1000041,1000042,1000043,1000044,1000020,1000001,1000045,1000010,1000046,1000020,1000001,1000047,1000001,1000048,1000049,1000050,1000051,1000001,1000052,1000053,1000054,1000055,1000001,1000056,1000057,1000058,1000020,1000001,1000059,1000001,1000060,1000001,1000010,1000061,1000062,1000020,1000001,1000063,1000001,1000010,1000064,1000065,1000020,1000001,1000066,1000001,1000010,1000067,1000020,1000001,1000068,1000001,1000069,1000001,1000070,1000071,1000072,1000001,1000073,1000074,1000075,1000001,1000076,1000077,1000078,1000001,1000079,1000080,1000081,1000001,1000082,1000001,1000083,1000001,1000084,1000085,1000086,1000087,1000001,1000088,1000089,1000090,1000091,1000092,1000093,1000094,1000095,1000058,1000020,1000001,1000096,1000001,1000097,1000001,1000098,1000001,1000099,1000010,1000100,1000020,1000001,1000101,1000010,1000102,1000020,1000001,1000103,1000010,1000104,1000020,1000001,1000105,1000010,1000061,1000020,1000001,1000106,1000010,1000107,1000108,1000109,1000110,1000020,1000001,1000111,1000001,1000112,1000113,1000001,1000114,1000001,1000115,1000116,1000117,1000001,1000118,1000001,1000119,1000001,1000010,1000120,1000121,1000001,1000122,1000123,1000020,1000001,1000124,1000001,1000125,1000001,1000126,1000127,1000128,1000020,1000001,1000129,1000010,1000130,1000131,1000132,1000020,1000001,1000133,1000001,1000134,1000135,1000136,1000137,1000001,1000138,1000001,1000139,1000140,1000141,1000142,1000001,1000001]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}